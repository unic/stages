import e from"lodash/get";export{default as get}from"lodash/get";import"core-js/modules/es.object.assign.js";import"core-js/modules/web.dom-collections.iterator.js";import t,{useState as i,useEffect as n,useCallback as o,useRef as a,Fragment as r}from"react";import s from"lodash/findindex";import"core-js/modules/es.json.stringify.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.string.split.js";import l from"json-beautify";import"core-js/modules/es.array.reverse.js";import"core-js/modules/es.array.sort.js";import"core-js/modules/es.number.to-fixed.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.regexp.constructor.js";import"core-js/modules/es.regexp.test.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.string.starts-with.js";import c from"lodash/find";import d from"lodash/sortby";import f from"lodash/uniqwith";import p from"lodash/isequal";import u from"lodash/set";import y from"lodash/unset";import g from"lodash/merge";import m from"fast-json-stable-stringify";function h(e){var t={exports:{}};return e(t,t.exports),t.exports}var b="function"==typeof Symbol&&Symbol.for,v=b?Symbol.for("react.element"):60103,O=b?Symbol.for("react.portal"):60106,E=b?Symbol.for("react.fragment"):60107,x=b?Symbol.for("react.strict_mode"):60108,j=b?Symbol.for("react.profiler"):60114,S=b?Symbol.for("react.provider"):60109,w=b?Symbol.for("react.context"):60110,A=b?Symbol.for("react.async_mode"):60111,C=b?Symbol.for("react.concurrent_mode"):60111,D=b?Symbol.for("react.forward_ref"):60112,k=b?Symbol.for("react.suspense"):60113,F=b?Symbol.for("react.suspense_list"):60120,V=b?Symbol.for("react.memo"):60115,R=b?Symbol.for("react.lazy"):60116,T=b?Symbol.for("react.block"):60121,P=b?Symbol.for("react.fundamental"):60117,I=b?Symbol.for("react.responder"):60118,L=b?Symbol.for("react.scope"):60119;function q(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case v:switch(e=e.type){case A:case C:case E:case j:case x:case k:return e;default:switch(e=e&&e.$$typeof){case w:case D:case R:case V:case S:return e;default:return t}}case O:return t}}}function W(e){return q(e)===C}var N={AsyncMode:A,ConcurrentMode:C,ContextConsumer:w,ContextProvider:S,Element:v,ForwardRef:D,Fragment:E,Lazy:R,Memo:V,Portal:O,Profiler:j,StrictMode:x,Suspense:k,isAsyncMode:function(e){return W(e)||q(e)===A},isConcurrentMode:W,isContextConsumer:function(e){return q(e)===w},isContextProvider:function(e){return q(e)===S},isElement:function(e){return"object"==typeof e&&null!==e&&e.$$typeof===v},isForwardRef:function(e){return q(e)===D},isFragment:function(e){return q(e)===E},isLazy:function(e){return q(e)===R},isMemo:function(e){return q(e)===V},isPortal:function(e){return q(e)===O},isProfiler:function(e){return q(e)===j},isStrictMode:function(e){return q(e)===x},isSuspense:function(e){return q(e)===k},isValidElementType:function(e){return"string"==typeof e||"function"==typeof e||e===E||e===C||e===j||e===x||e===k||e===F||"object"==typeof e&&null!==e&&(e.$$typeof===R||e.$$typeof===V||e.$$typeof===S||e.$$typeof===w||e.$$typeof===D||e.$$typeof===P||e.$$typeof===I||e.$$typeof===L||e.$$typeof===T)},typeOf:q};function z(){}function $(){}h(function(e,t){}),h(function(e){e.exports=N}),$.resetWarningCache=z;var _=h(function(e){e.exports=function(){function e(e,t,i,n,o,a){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==a){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:$,resetWarningCache:z};return i.PropTypes=i,i}()});const H=function(e,t,i){if(void 0===i&&(i="stages-form-"),"local"===t&&"undefined"!=typeof localStorage||"session"===t&&"undefined"!=typeof sessionStorage){const t=localStorage.getItem(""+i+e)||"{}";let n={};try{n=JSON.parse(t)}catch(e){}return n}return{}},B=function(e,t,i,n){if(void 0===t&&(t={}),void 0===n&&(n="stages-form-"),("local"===i&&"undefined"!=typeof localStorage||"session"===i&&"undefined"!=typeof sessionStorage)&&"object"==typeof t){let i="{}";try{i=JSON.stringify(t)}catch(e){}localStorage.setItem(""+n+e,i)}},U=function(e,t,i){void 0===i&&(i="stages-form-"),("local"===t&&"undefined"!=typeof localStorage||"session"===t&&"undefined"!=typeof sessionStorage)&&localStorage.removeItem(""+i+e)},M=()=>"undefined"!=typeof window&&"function"==typeof window.stagesLogging,J=e=>{let{children:t,initialData:o,initialStep:a,render:r,validateOnStepChange:l,onChange:c,autoSave:d,id:f}=e;const[p]=i("stages-"+(f||+new Date)),[u,y]=i((()=>{if(!f||"local"!==d&&"session"!==d&&("object"!=typeof d||"local"!==d.type&&"session"!==d.type)){if(f&&"object"==typeof d&&"custom"===d.type&&"function"==typeof d.get){const e=d.get(f);if(Object.keys(e).length>0)return e}}else{const e=H(f,"object"==typeof d?d.type:d);if(Object.keys(e).length>0)return e}return o})()),[g,m]=i([]),[h,b]=i({}),[v,O]=i(a||0),[E,x]=i([]),j=e=>{const t=E&&E[e]?E[e].key:e;return u&&u[t]?u[t]:{}},S=(e,t)=>(E[t]||(E[t]={key:e,visible:!0},x([...E])),e),w=(e,t,i)=>{const n=Object.assign({},u),o=E&&E[i]?E[i].key:i;M()&&window.stagesLogging('Handle onChange for "'+o+'"',p),h[i]=t,b(Object.assign({},h)),n[o]=e,u[o]=e,y(Object.assign({},n)),"function"==typeof c&&c({data:n,errors:h}),f&&("local"===d||"session"===d?0===Object.keys(h).length&&B(f,n,d):"object"!=typeof d||"local"!==d.type&&"session"!==d.type?f&&"object"==typeof d&&"custom"===d.type&&"function"==typeof d.save&&(d.validDataOnly&&0===Object.keys(h).length||!d.validDataOnly)&&d.save(f,n):(d.validDataOnly&&0===Object.keys(h).length||!d.validDataOnly)&&B(f,n,d.type))},A=()=>{f&&("local"!==d&&"session"!==d||U(f,d),"object"!=typeof d||"local"!==d.type&&"session"!==d.type||U(f,d.type),f&&"object"==typeof d&&"custom"===d.type&&"function"==typeof d.remove&&d.remove(f)),y(o),O(0),"function"==typeof c&&c({data:o,errors:h})};n(()=>{M()&&(!f||"local"!==d&&"session"!==d&&("object"!=typeof d||"local"!==d.type&&"session"!==d.type)?f&&"object"==typeof d&&"custom"===d.type&&"function"==typeof d.get?window.stagesLogging({id:p,keys:E,data:u,initialData:o,initialStep:a,errors:h,currentStep:v,savedData:d.get(f)}):window.stagesLogging({id:p,keys:E,data:u,initialData:o,initialStep:a,errors:h,currentStep:v,savedData:{}}):window.stagesLogging({id:p,keys:E,data:u,initialData:o,initialStep:a,errors:h,currentStep:v,savedData:H(f,"object"==typeof d?d.type:d)}))},[E,u,h,v]),n(()=>{M()&&window.stagesLogging("Init Stages",p),t.map((e,t)=>e({index:t,setStepKey:S,initializing:!0})).filter(e=>e)},[]),n(()=>{if(l){const e=D();e<v&&O(-1===e?0:e+1)}m(t.map((e,t)=>e({data:j(t),allData:u,onChange:w,reset:A,onNav:C,isActive:t===v,index:t,errors:h[t]||{},setStepKey:S})).filter((e,t)=>{const i=null!==e;return E[t]&&(E[t].visible=i),i}))},[v,u]);const C=(e,t)=>{let i=v;if(M()&&window.stagesLogging('On nav "'+e+'" -> "'+t+'"',p),"next"===e){let e=!1;for(let t=v+1;t<E.length;t++)E[t].visible&&!e&&(i=t,e=!0)}if("prev"===e){let e=!1;for(let t=v-1;t>=0;t--)E[t].visible&&!e&&(i=t,e=!0)}if("first"===e){let e=!1;for(let t=0;t<E.length;t++)E[t].visible&&!e&&(i=t,e=!0)}if("last"===e){let e=!1;for(let t=E.length-1;t>=0;t--)E[t].visible&&!e&&(i=t,e=!0)}if("lastValid"===e&&(i=D()),"step"===e&&E[t]&&E[t].visible)i=Number(t);else if("step"===e&&"string"==typeof t){const e=s(E,{key:t});e>-1&&(i=e)}i<0&&(i=0),i>E.length&&(i=E.length),O(i)},D=()=>{let e=-1,t=!1;return Object.keys(h).forEach(i=>{const n=s(E,{key:i});(0===Object.keys(h[i]).length||n>-1&&!E[n].visible)&&!t?e=Number(i):t=!0}),e};return 0===g.length?null:r?r({navigationProps:{currentStep:v,data:u,onChangeStep:e=>{const t=D();M()&&window.stagesLogging('On change step "'+e+'"',p),("number"==typeof t&&"number"==typeof e&&t+1>=e||!1===l)&&O(e)},errors:h,keys:E,stepCount:g.length,lastValidStep:D(),reset:A},progressionProps:(()=>{const e=g.length,t=D();let i=0;return Object.keys(h).forEach((e,n)=>{const o=j(n);n<=t&&0===Object.keys(h[n]).length&&Object.keys(o).length>0&&i++}),{currentStep:v,stepCount:e,validSteps:i,percentage:100/e*i,data:u,errors:h}})(),routerProps:{step:v,onChange:O,keys:E},steps:g}):null};J.propTypes={children:_.arrayOf(_.oneOfType([_.node,_.func])).isRequired,initialData:_.object,render:_.oneOfType([_.node,_.func]).isRequired,initialStep:_.number,validateOnStepChange:_.bool,id:_.oneOfType([_.string,_.number])},J.defaultProps={initialData:{},validateOnStepChange:!0,autoSave:!1};const G=e=>{let{step:t,onChange:a,keys:r,prefix:l,hashFormat:c="#!"}=e;const[d,f]=(()=>{const[e,t]=i(()=>window.location.hash),a=o(()=>{t(window.location.hash)},[]);var r,s;r=()=>{!function(e){e&&e.addEventListener&&e.addEventListener(...[].slice.call(arguments,1))}(window,"hashchange",a)},s=()=>{!function(e){e&&e.removeEventListener&&e.removeEventListener(...[].slice.call(arguments,1))}(window,"hashchange",a)},n(()=>(r&&r(),()=>{s&&s()}),[]);const l=o(t=>{t!==e&&(window.location.hash=t)},[e]);return[e,l]})(),[p,u]=i(!1),y=e=>r&&r[e]?r[e].key:l?l+"-"+e:e,g=()=>{if("string"==typeof d&&-1!==d.indexOf(c)){const e=(e=>{const t=e.split(c);if(2===t.length){const e=t[1];return(e=>{var t=Math.floor(Number(e));return Infinity!==t&&String(t)===e&&t>=0})(e)?Number(e):s(r,{key:e})}return-1})(d);-1!==e&&("function"==typeof f&&f(""+c+y(e)),a(e))}else"function"==typeof f&&f(""+c+y(t))};return n(()=>{p&&g()},[d]),n(()=>{p&&"function"==typeof f&&f(""+c+y(t))},[t]),m=()=>{g(),u(!0)},n(()=>{m()},[]),null;var m},K=e=>{let{currentStep:i,onChangeStep:n,lastValidStep:o,keys:a}=e;const r=[];for(let e=0;e<a.length;e++)if(a&&a[e]&&a[e].visible){const s=a&&a[e]?a[e].key:"Step "+(e+1);r.push(i===e?/*#__PURE__*/t.createElement("li",{key:s,style:{textTransform:"capitalize"}},/*#__PURE__*/t.createElement("strong",null,s)):/*#__PURE__*/t.createElement("li",o>-1&&o+1<e||-1===o&&e>0?{key:s,style:{color:"#999",textTransform:"capitalize"}}:{key:s,style:{textTransform:"capitalize"},onClick:()=>n(e)},s))}/*#__PURE__*/return t.createElement("ul",null,r)},X=e=>{let{stepCount:i,validSteps:n,percentage:o}=e;/*#__PURE__*/return t.createElement("div",null,n+" / "+i+" ("+Math.round(o)+"%)")},Y=()=>{const[o,a]=i({}),[r,s]=i({}),[c,d]=i({}),[f,p]=i({}),[u,y]=i(!1),g=(e,t)=>{if("string"==typeof e)r[t]||(r[t]=[]),r[t].push({action:e,time:+new Date}),s(r);else{const t=Object.assign(o,{}),i=Object.keys(t)[0];t[e.id]=e,a(Object.assign({},t)),d(e=>({key:e.key?e.key:i,tab:e.tab?e.tab:"data"}))}};return n(()=>{"undefined"!=typeof window&&(window.stagesLogging=g)},[]),0===Object.keys(o).length?null:/*#__PURE__*/t.createElement("div",{style:{position:"absolute",top:"8px",right:"8px",width:"320px",padding:"8px",fontSize:"14px",color:"#333",border:"1px #bbb solid",borderRadius:"4px",background:"#fbfbfb",fontFamily:"Open Sans, Helvetica, Arial, sans",zIndex:1e3}},/*#__PURE__*/t.createElement("strong",{style:{lineHeight:"22px"}},"Debugger:"),/*#__PURE__*/t.createElement("button",{type:"button",style:{float:"right"},onClick:()=>y(!u)},u?"hide":"show"),u?Object.keys(o).map(i=>{const n=i.split("-");n.pop();let a="";return a="logs"===c.tab?r[c.key]?r[c.key].map(e=>e.time+": "+e.action).join("\n"):"":l(f[i]?e(o[c.key][c.tab],f[i]||""):o[c.key][c.tab],null,2),/*#__PURE__*/t.createElement("div",{key:i+"-"+c.tab},/*#__PURE__*/t.createElement("h3",{style:{background:"#333",color:"#fff",margin:"8px 0 0 0",padding:"2px 6px",textTransform:"capitalize",position:"relative"}},n.join(" "),":",o[i].isDirty?/*#__PURE__*/t.createElement("span",{style:{display:"inline-block",position:"absolute",top:"5px",right:"4px",background:"#f30",color:"#fff",fontSize:"11px",padding:"1px 4px"}},"dirty"):null,Object.keys(o[i].errors).length?/*#__PURE__*/t.createElement("span",{style:{display:"inline-block",position:"absolute",top:"5px",right:"48px",background:"#f30",color:"#fff",fontSize:"11px",padding:"1px 4px"}},"errors"):null,o[i].loading?/*#__PURE__*/t.createElement("span",{style:{display:"inline-block",position:"absolute",top:"5px",right:"98px",background:"#f30",color:"#fff",fontSize:"11px",padding:"1px 4px"}},"loading"):null),/*#__PURE__*/t.createElement("div",null,/*#__PURE__*/t.createElement("select",{onChange:e=>d({key:i,tab:e.target.value}),value:c.key===i?c.tab:"data",style:{width:"47%",minWidth:"47%",maxWidth:"47%",marginRight:"2%",height:"25px"}},o[i].keys?/*#__PURE__*/t.createElement(t.Fragment,null,/*#__PURE__*/t.createElement("option",{value:"data"},"Data"),/*#__PURE__*/t.createElement("option",{value:"errors"},"Errors"),/*#__PURE__*/t.createElement("option",{value:"initialData"},"Initial Data"),/*#__PURE__*/t.createElement("option",{value:"savedData"},"Saved Data"),/*#__PURE__*/t.createElement("option",{value:"keys"},"Keys"),/*#__PURE__*/t.createElement("option",{value:"logs"},"Logs")):/*#__PURE__*/t.createElement(t.Fragment,null,/*#__PURE__*/t.createElement("option",{value:"data"},"Data"),/*#__PURE__*/t.createElement("option",{value:"errors"},"Errors"),/*#__PURE__*/t.createElement("option",{value:"parsedFieldConfig"},"Field Config"),/*#__PURE__*/t.createElement("option",{value:"initialData"},"Initial Data"),/*#__PURE__*/t.createElement("option",{value:"interfaceState"},"Interface State"),/*#__PURE__*/t.createElement("option",{value:"undoData"},"Undo Data"),/*#__PURE__*/t.createElement("option",{value:"asyncData"},"Async Data"),/*#__PURE__*/t.createElement("option",{value:"savedData"},"Saved Data"),/*#__PURE__*/t.createElement("option",{value:"fieldPaths"},"Field Paths"),/*#__PURE__*/t.createElement("option",{value:"logs"},"Logs"))),/*#__PURE__*/t.createElement("input",{value:f[i]||"",placeholder:"your.data.filter.path",onChange:e=>{const t=Object.assign({},f);t[i]=e.target.value,p(t)},style:{width:"47%",minWidth:"47%",maxWidth:"47%",fontSize:"12px",border:"1px #ccc solid",background:"#fbfbfb",marginTop:"4px",padding:"4px",overflowX:"scroll",whiteSpace:"pre"}})),c&&c.key===i?/*#__PURE__*/t.createElement("textarea",{readOnly:!0,style:{width:"calc(100% - 8px)",minWidth:"calc(100% - 8px)",maxWidth:"calc(100% - 8px)",height:"200px",fontSize:"10px",border:"1px #ccc solid",background:"#fbfbfb",marginTop:"8px",overflowX:"scroll",whiteSpace:"pre"},value:a}):null)}):null)},Q=(e,t,i)=>i&&Array.isArray(e)?"number"===t?e.map(e=>Number(e)):"string"===t?e.map(e=>String(e)):"boolean"===t?e.map(e=>Boolean(e)):"date"===t?e.map(e=>new Date(e)):e:"number"===t?Number(e):"string"===t?String(e):"boolean"===t?Boolean(e):"date"===t?new Date(e):e,Z=(e,t)=>{const i={};return Object.keys(t).forEach(n=>{i[n]=void 0!==e[n]?e[n]:t[n].default,void 0===e[n]&&t[n].required&&console.warn('Param "'+n+'" is required but is missing in field configs!'),void 0!==e[n]&&typeof e[n]!==t[n].type&&console.warn('Param "'+n+'" is not of type "'+t[n].type+'"!')}),i},ee={};let te,ie,ne,oe=0;const ae={},re=o=>{let{config:r,data:l,render:h,renderFields:b,fields:v,onChange:O,isVisible:E,isDisabled:x,id:j,onValidation:S,parentRunValidation:w,validateOn:A,throttleWait:C,customEvents:D,enableUndo:k,undoMaxDepth:F,customRuleHandlers:V,autoSave:R,typeValidations:T,fieldsets:P,initialInterfaceState:I,hashSeparator:L}=o;const q=a(!1),[W,N]=i(I),z=Object.assign({},l);g(z,W);const[$]=i("form-"+(j||"noid")+"-"+ +new Date),[_,J]=i(!1),[G,K]=i({}),[X,Y]=i(!1),[se,le]=i([]),[ce,de]=i(0),[fe,pe]=i(!1),[ue,ye]=i(!1),[ge,me]=i({}),[he,be]=i({}),[ve,Oe]=i(),[Ee,xe]=i({}),[je,Se]=i(!1),[we,Ae]=i(""),[Ce,De]=i(""),[ke,Fe]=i([]),[Ve,Re]=i({}),Te=((t,i,n,o,a,r)=>{let l="function"==typeof t.fields?t.fields(i,n,o):"function"==typeof t?t(i,n,o):Array.isArray(t)?t:[];const c=e=>{if("string"==typeof e&&t.fieldConfigs&&"function"==typeof t.fieldConfigs[e])return t.fieldConfigs[e](i,n,o);if("object"==typeof e&&t.fieldConfigs&&"function"==typeof t.fieldConfigs[e.type]){const a=t.fieldConfigs[e.type](i,n,o);return Object.assign({},a,e,{type:a.type})}return"object"==typeof e&&r[e.type]?{id:e.id,type:"fieldset",fieldset:e.type,fields:r[e.type].config({data:i,asyncData:n,interfaceState:o,params:Z(e.params||{},r[e.type].params)}),params:e.params}:"function"==typeof e?e(i,n,o):e};return l=l.map(e=>("object"!=typeof e||"group"!==e.type&&"collection"!==e.type&&"fieldset"!==e.type||!Array.isArray(e.fields)||(e.fields=e.fields.map(e=>c(e))),"object"==typeof e&&"wizard"===e.type&&Array.isArray(e.stages)&&(e.stages=e.stages.map(e=>c(e))),c(e))),a.forEach(t=>{const o=e(l,t.path);if(Array.isArray(o)){if("add"===t.action&&o.push(t.fields(i,n)),"remove"===t.action){const e=t.fields(i,n),a=s(o,{id:e.id});a>-1&&o.splice(a,1)}u(l,t.path,o)}}),l})(r,z,ve,W,ke,P),Pe=((t,i,n)=>{const o=[];return function a(r,s,l){void 0===r&&(r=""),void 0===s&&(s=""),void 0===l&&(l="");let c=[r?e(t,r):t],d=[];Array.isArray(c[0])||(d=Object.keys(c[0]),c=Object.values(c[0])),("stage"!==l||((e,t)=>{let i=!1;return Object.keys(e).forEach(n=>{n+"."+e[n]===t&&(i=!0)}),i})(n,s))&&c.forEach((t,n)=>{const l=void 0!==d[n]?d[n]:void 0;Array.isArray(t)&&t.forEach((t,n)=>{const c=s?s+"."+t.id:t.id,d=e(i,c),f=e(i,s);if((l&&f&&f.__typename===l||!l)&&o.push({path:c,config:t,data:d}),"collection"===t.type){const o=s?e(i,s+"."+t.id):i[t.id];o&&Array.isArray(o)&&o.forEach((e,i)=>{a(r+"["+n+"].fields",s?s+"."+t.id+"["+i+"]":t.id+"["+i+"]")})}else"group"===t.type||"fieldset"===t.type||"stage"===t.type?a(r+"["+n+"].fields",c,t.type):"wizard"===t.type&&a(r+"["+n+"].stages",c,"wizard")})})}(),o})(Te,z,Ve);n(()=>(q.current=!0,()=>{q.current=!1}),[]),n(()=>{const e=("undefined"!=typeof window?window.location.hash.substring(2):"").split(L||":"),t=Object.assign({},Ve);e.forEach(e=>{const i=e.split("."),n=i.slice(0,-1).join("."),o=i[i.length-1];n&&o&&(t[n]=o)}),Pe.forEach(e=>{"wizard"!==e.config.type||t[e.path]&&(!t[e.path]||c(e.config.stages,{id:t[e.path]}))||(t[e.path]=e.config.stages[0].id)}),JSON.stringify(Ve)!==JSON.stringify(t)&&Re(t)},[r]);const Ie=()=>q&&!0===q.current;n(()=>{if(l&&!X){let t;M()&&window.stagesLogging("Set initial data",$),Pe.forEach(i=>{if(void 0!==i.config.defaultValue&&void 0===e(l,i.path)){const e="function"==typeof i.config.defaultValue?i.config.defaultValue(l):i.config.defaultValue;u(l,i.path,e),u(z,i.path,e)}if(Array.isArray(i.config.validateOn)&&i.config.validateOn.indexOf("init")>-1||Array.isArray(A)&&A.indexOf("init")>-1){const e=We(i.path,"init",l,Ee);t=Object.assign({},Ee,e)}t&&xe(t)});const i=m(l);let n;Y(JSON.parse(i)),"local"===R||"session"===R||"object"==typeof R&&("local"===R.type||"session"===R.type)?n=H(j,"object"==typeof R?R.type:R):j&&"object"==typeof R&&"custom"===R.type&&"function"==typeof R.get&&(n=R.get(j)),n&&Object.keys(n).length>0&&setTimeout(()=>{J(!!n.isDirty),K("object"==typeof n.dirtyFields?n.dirtyFields:{}),He(n.data,Ne(!1,n.data),j)},0)}},[l]),n(()=>{if(M()){let e;e="local"===R||"session"===R||"object"==typeof R&&("local"===R.type||"session"===R.type)?H(j,"object"==typeof R?R.type:R):j&&"object"==typeof R&&"custom"===R.type&&"function"==typeof R.get?R.get(j):{},window.stagesLogging({id:$,data:l,initialData:X,interfaceState:W,undoData:se,asyncData:ve,errors:Ee,fieldPaths:Pe,isDirty:_,focusedField:we,lastFocusedField:Ce,dirtyFields:G,loading:je,parsedFieldConfig:Te,savedData:e})}},[l,Ee,_,we,Ce,G,je]);const Le=e=>"collection"===e||"subform"===e||"group"===e||"fieldset"===e||"config"===e||"wizard"===e||"stage"===e,qe=(t,i,n,o)=>{if(!v[i.type])return!0;const a=e(n,t),r=!Le(i.type)&&v[i.type].isValid(a,i);if(T[i.type]&&"function"==typeof T[i.type].validation&&!i.customValidation)return T[i.type].validation({data:a,allData:n,interfaceState:W,fieldConfig:i,isValid:r,fieldHasFocus:!(!we||we!==t),fieldIsDirty:void 0!==G[t],triggeringEvent:o});if(("string"==typeof i.regexValidation||i.regexValidation instanceof RegExp)&&!i.customValidation){let e;if("string"==typeof i.regexValidation)try{e=new RegExp(i.regexValidation)}catch(e){}else e=i.regexValidation;return r&&(e.test(a)||!a)}if(!Le(i.type)&&"function"==typeof i.customValidation){const e=i.customValidation({data:a,allData:n,interfaceState:W,fieldConfig:i,isValid:r,fieldHasFocus:!(!we||we!==t),fieldIsDirty:void 0!==G[t],triggeringEvent:o});if(!function(e){return e&&"[object Promise]"===Object.prototype.toString.call(e)}(e))return e;!function(){const n=+new Date;te=Object.assign({},te,{[t]:n}),e.then(e=>{te[t]===n&&(!0!==e?(delete te[t],xe(Object.assign({},Ee,{[t]:{field:i}}))):(delete te[t],xe(Object.assign({},Ee))),te=Object.assign({},te))})}()}return r},We=(t,i,n,o,a)=>{const r=c(Pe,{path:t}).config;M()&&"render"!==i&&window.stagesLogging('Validate field "'+t+'"',$);const s=qe(t,r,n,i),l=e(n,t);return o[t]&&delete o[t],Le(r.type)||!0===s?"collection"===r.type&&r.isRequired&&(!l||0===l.length||1===l.length&&0===Object.keys(l[0]).length)?(a||(a=t),o[t]={value:l,field:r}):"collection"===r.type&&(Array.isArray(r.fields)?r.fields.forEach(a=>{l&&l.forEach((s,c)=>{const d=t+"["+c+"]."+a.id;if(!(r.isRequired||s&&0!==Object.keys(s).length))return;const f=qe(a,d,s,i);if(v[a.type]&&!0!==f)o[t]={value:l,subField:a,errorCode:!1!==f?f:void 0};else if(v[a.type]&&a.isUnique){let i=e(n,t,[]).filter(e=>void 0!==e[a.id]).map(e=>e[a.id]);[...new Set(i)].length!==i.length&&(o[t]={value:l,subField:a,errorCode:"notUnique"})}})}):l&&l.forEach((e,n)=>{(r.isRequired||e&&0!==Object.keys(e).length)&&r.fields[e.__typename]&&r.fields[e.__typename].forEach(a=>{const r=qe(a,t+"["+n+"]."+a.id,e,i);v[a.type]&&!0!==r&&(o[t]={value:l,subField:a,errorCode:!1!==r?r:void 0})})})):(a||(a=t),o[t]={value:l,field:r,errorCode:!1!==s?s:void 0}),"collection"===r.type&&r.uniqEntries&&l&&f(l,(e,t)=>m(e)===m(t)).length!==l.length&&(o[t]={value:l,field:r}),"collection"===r.type&&r.rules&&"object"==typeof r.rules&&l&&Object.keys(r.rules).forEach(i=>{const n=r.rules[i];Object.keys(n).forEach(a=>{const s=n[a],c=i.indexOf(",")>-1?i.split(","):[i],d=a.indexOf(",")>-1?a.split(","):[a],f=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);const i=[];return e.forEach(e=>{t.forEach(t=>{i.push([e,t])})}),i}(c,d);let u=!0;if(s.maxCount&&"number"==typeof s.maxCount&&f.forEach(t=>{let i=0;l.forEach(n=>e(n,t[0])===t[1]?i++:void 0),i>s.maxCount&&(u=!1)}),s.minCount&&"number"==typeof s.minCount&&f.forEach(t=>{let i=0;l.forEach(n=>e(n,t[0])===t[1]?i++:void 0),i<s.minCount&&(u=!1)}),s.exactCount&&"number"==typeof s.exactCount&&f.forEach(t=>{let i=0;l.forEach(n=>e(n,t[0])===t[1]?i++:void 0),i!==s.exactCount&&(u=!1)}),s.sameCountAs&&"string"==typeof s.sameCountAs&&f.forEach(t=>{let i=0,n=0;l.forEach(o=>{e(o,t[0])===t[1]&&i++,e(o,t[0])===s.sameCountAs&&n++}),i!==n&&(u=!1)}),s.differentCountAs&&"string"==typeof s.differentCountAs&&f.forEach(t=>{let i=0,n=0;l.forEach(o=>{e(o,t[0])===t[1]&&i++,e(o,t[0])===s.differentCountAs&&n++}),i===n&&(u=!1)}),(s.sameSumAs&&"string"==typeof s.sameSumAs||s.differentSumAs&&"string"==typeof s.differentSumAs||s.biggerSumAs&&"string"==typeof s.biggerSumAs||s.smallerSumAs&&"string"==typeof s.smallerSumAs)&&f.forEach(t=>{let i=0,n=0;l.forEach(o=>{const a=Number(e(o,t[0])),r=Number(e(o,s.sameSumAs||s.differentSumAs||s.biggerSumAs||s.smallerSumAs));isNaN(a)||(i+=a),isNaN(r)||(n+=r)}),s.sameSumAs&&i!==n&&(u=!1),s.differentSumAs&&i===n&&(u=!1),s.biggerSumAs&&i<=n&&(u=!1),s.smallerSumAs&&i>=n&&(u=!1)}),s.isUnique&&c.length>0){const t=[];let i=!1;l.forEach(n=>{const o=c.map(t=>e(n,t));t.forEach(e=>{p(o,e)&&(i=!0)}),t.push(o)}),i&&(u=!1)}s.disallow&&f.forEach(t=>{let i=!1,n=!1;l.forEach(o=>{e(o,t[0])===t[1]&&(n=!0),Array.isArray(s.disallow)?s.disallow.forEach(n=>{e(o,t[0])===n&&(i=!0)}):e(o,t[0])===s.disallow&&(i=!0)}),n&&i&&(u=!1)}),s.disallow&&f.forEach(t=>{let i=!1,n=!1;l.forEach(o=>{e(o,t[0])===t[1]&&(n=!0),Array.isArray(s.disallow)?s.disallow.forEach(n=>{e(o,t[0])===n&&(i=!0)}):e(o,t[0])===s.disallow&&(i=!0)}),n&&!i&&(u=!1)}),u&&"object"==typeof V&&Object.keys(V).forEach(t=>{void 0!==s[t]&&"function"==typeof V[t]&&(V[t]({fieldValueCombos:f,fieldValidationData:l,valueRules:s,get:e})||(u=!1))}),u||(o[t]={value:l,field:r,errorCode:s.errorCode||"invalidRule"})})}),{errors:o,firstErrorField:a}},Ne=function(e,t,i){void 0===i&&(i="");let n,o={};if(t||(t=z),Pe.forEach(e=>{if(""===i||e.path.startsWith(i)){if(!v[e.config.type]&&!Le(e.config.type))return;const a=We(e.path,""!==i?"render":"action",t,o,n);o=a.errors,n=a.firstErrorField}}),n&&E&&e){const e=document.getElementById(n);e&&!(e=>{const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)})(e)&&e.scrollIntoView()}return o},ze=()=>Ne(!1);n(()=>{if("function"==typeof S&&w){M()&&window.stagesLogging("Get errors on validation",$);let e=Ne(!0);xe(e),S(e)}},[S]);const $e=(e,t)=>{M()&&window.stagesLogging('Get sub form errors for sub id "'+e+'"',$),Ne(!0),t&&Object.keys(t).length>0&&(Ee[e]=t)},_e=function(t,i,n){try{const o=function(){if(i.loader&&"function"==typeof i.loader){function o(){i.enableCaching&&((e,t)=>{M()&&window.stagesLogging('Update options cache for "'+e+'"',$),be(i=>Object.assign({},i,{[e]:t}))})(r,s),c===l&&(((e,t)=>{M()&&window.stagesLogging('Update options loaded for "'+e+'"',$),me(i=>Object.assign({},i,{[e]:t}))})(t,s),i.onOptionsChange&&"function"==typeof i.onOptionsChange&&i.onOptionsChange(s,n,Xe))}const a={};let r,s;const l="number"==typeof ee[t]?ee[t]+1:0;let c=l;ee[t]=l,M()&&window.stagesLogging('Create dynamic options for field "'+t+'"',$),i.enableCaching&&(i.watchFields.forEach(t=>{const i=e(n,t);i&&(a[t]=i)}),r=t+"-"+m(a));const d=function(){if(!i.enableCaching||!he[r])return Promise.resolve(i.loader(n,Xe)).then(function(e){s=e,c=ee[t]});s=he[r]}();return d&&d.then?d.then(o):o()}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},He=function(t,i,n,o,a){let r;void 0===a&&(a=!1);try{r=m({newData:t,errors:Object.keys(i),id:n,fieldKey:o,interfaceState:W})}catch(e){}(r!==ne||a)&&(O((t=>{const i={},n=Object.assign({},t);return Pe.forEach(o=>{if(o.config.isInterfaceState){const a=e(t,o.path);void 0!==a&&(u(i,o.path,a),y(n,o.path))}}),N(i),n})(t),i,n,o,W,Ne(!1,t)),ne=r)},Be=()=>{if(Ie()&&k&&ce>0){const e=ce-1,t=JSON.parse(se[e]);de(e),xe(t.errors),J(t.isDirty),K(t.dirtyFields),He(t.data,t.errors,j)}},Ue=()=>{if(Ie()&&k&&ce<se.length-1){const e=ce+1,t=JSON.parse(se[e]);de(e),xe(t.errors),J(t.isDirty),K(t.dirtyFields),He(t.data,t.errors,j)}};n(()=>{let t=Object.assign({},z);if(M()&&window.stagesLogging('Is visible change to "'+(E?"visible":"invisible")+'"',$),Pe.forEach(i=>{const n=i.config;let o=e(t,i.path);if("collection"===n.type&&n.init){const e=n.min?Number(n.min):1;o&&0!==o.length||(o=[]);for(let i=o.length;i<e;i++)o.push("string"==typeof n.init?"function"==typeof n.setInitialData?n.setInitialData(o,t,n.init):{__typename:n.init}:"function"==typeof n.setInitialData?n.setInitialData(o,t):{});u(t,i.path,o)}}),t=Me(t),"function"==typeof r.asyncDataLoader&&E&&!ue)try{return Se(!0),Promise.resolve(r.asyncDataLoader()).then(function(e){Oe(e),ye(!0),Se(!1)})}catch(e){Promise.reject(e)}E&&(Array.isArray(Pe)&&Pe.forEach(e=>{e.config.dynamicOptions&&e.config.dynamicOptions.events&&e.config.dynamicOptions.events.indexOf("init")>-1&&_e(e.path,e.config.dynamicOptions,t)}),0===ce&&0===se.length&&le([m({data:t,isDirty:_,dirtyFields:G,errors:Ee})])),He(t,Ne(),j)},[E]);const Me=t=>{const i=Object.assign({},t);return Pe.forEach(n=>{if("function"==typeof n.config.computedValue){const o=e(z,n.path.split(".").slice(0,-1).join(".")),a=n.config.computedValue(t,o,W);u(i,n.path,a)}}),i},Je=e=>c(Pe,{path:e}).config,Ge=(e,t,i)=>{const n=[];return"object"==typeof D&&Object.keys(D).forEach(o=>{"function"==typeof D[o]&&D[o]({fieldValue:i,data:t,dirtyFields:G,optionsLoaded:ge,asyncData:ve,errors:Ee,focusedField:we,triggeringEvent:e})&&n.push(o)}),n},Ke=e=>Array.isArray(e)&&1===e.length?e[0]:e,Xe=function t(i,n,o,a){if(void 0===a&&(a=!1),!Ie())return;let r,s=!1;const l=+new Date,c=Je(i);a||(oe=l);let f=Object.assign({},o||z),y="function"==typeof c.filter?c.filter(n):n;c.cast&&"function"==typeof c.cast.data&&(y=c.cast.data(y)),c.cast&&"string"==typeof c.cast.data&&(y=Q(y,c.cast.data)),c.cast&&Array.isArray(c.cast.data)&&(y=Q(y,c.cast.data[0],!0)),M()&&window.stagesLogging('Handle change for field "'+i+'"',$),u(f,i,y||void 0),f=Me(f);const g={data:e(f,i),fieldIsDirty:!!G[i],fieldConfig:c,fieldHasFocus:!(!we||we!==i)};a||(0===oe||l-oe<Number(C||400))&&(!c.validateOn&&Array.isArray(A)&&A.indexOf("throttledChange")>-1||c.validateOn&&Array.isArray(c.validateOn)&&c.validateOn.indexOf("throttledChange")>-1||!c.validateOn&&"function"==typeof A&&A(g).indexOf("throttledChange")>-1||c.validateOn&&"function"==typeof c.validateOn&&c.validateOn(g).indexOf("throttledChange")>-1)&&(ie&&clearTimeout(ie),ie=setTimeout(()=>t(i,n,o,!0),C||400),s=!0);const m=Ge("change",f,y);if(!c.validateOn&&Array.isArray(A)&&m.some(e=>A.indexOf(e)>-1)||c.validateOn&&Array.isArray(c.validateOn)&&m.some(e=>c.validateOn.indexOf(e)>-1)){const e=We(i,Ke(m),f,Ee);r=Object.assign({},Ee,e.errors),xe(r)}else if(!c.validateOn&&Array.isArray(A)&&A.indexOf("change")>-1||c.validateOn&&Array.isArray(c.validateOn)&&c.validateOn.indexOf("change")>-1||!c.validateOn&&Array.isArray(A)&&A.indexOf("throttledChange")>-1&&!s||c.validateOn&&Array.isArray(c.validateOn)&&c.validateOn.indexOf("throttledChange")>-1&&!s||!c.validateOn&&"function"==typeof A&&A(g).indexOf("change")>-1||c.validateOn&&"function"==typeof c.validateOn&&c.validateOn(g).indexOf("change")>-1||!c.validateOn&&"function"==typeof A&&A(g).indexOf("throttledChange")>-1&&!s||c.validateOn&&"function"==typeof c.validateOn&&c.validateOn(g).indexOf("throttledChange")>-1&&!s){const e=We(i,"change",f,Ee);r=Object.assign({},Ee,e.errors),xe(r)}if(X&&(p(e(f,i),e(X,i))?void 0!==G[i]&&delete G[i]:G[i]={oldData:e(X,i),newData:e(f,i)},J(Object.keys(G).length>0),K(G)),c.clearFields&&(Array.isArray(c.clearFields)||"function"==typeof c.clearFields)){const e=Object.assign({},ge);(Array.isArray(c.clearFields)?c.clearFields:c.clearFields(y,f,r)).forEach(t=>{u(f,t,void 0),delete e[t]}),me(e)}if(Array.isArray(Pe)&&Pe.forEach(t=>{t.config.dynamicOptions&&t.config.dynamicOptions.events&&t.config.dynamicOptions.events.indexOf("change")>-1&&t.config.dynamicOptions.watchFields&&t.config.dynamicOptions.watchFields.indexOf(i)>-1&&(!c.dynamicOptions||c.dynamicOptions&&ge[t.path]&&ge[t.path].indexOf(e(f,i))>-1||!ge[t.path])&&_e(t.path,t.config.dynamicOptions,f)}),(e=>{const t=e.split(".").at(-2);return"]"===(t?t.slice(-1):"")})(i)){const t=(e=>{const t=e.split(".");t.pop();let i=t.join(".");if("]"===i.slice(-1)){const e=i.lastIndexOf("[");i=i.substring(0,e)}return i})(i),n=Je(t);if(n.sort&&n.sort.by&&n.sort.by.indexOf(c.id)>-1){let i=e(f,t,[]);i=d(i,n.sort.by),"desc"===n.sort.dir&&(i=i.reverse()),u(f,t,i)}}He(f,Ne(!1,f),j,i)},Ye=i=>{const n={},o=[];return Pe.forEach(a=>{if(!i||a.path.startsWith(i+"."))if("fieldset"===a.config.type&&P[a.config.fieldset]){const t=Ye(a.path);u(n,a.path,P[a.config.fieldset].render({params:Z(a.config.params||{},P[a.config.fieldset].params),fieldProps:{fields:e(t,a.path),onCollectionAction:Qe,onWizardNav:Ze,getWizardNavHash:et,isWizardStepActive:tt,isWizardStepDisabled:it,modifyConfig:nt,data:l,interfaceState:W,errors:Ee,asyncData:ve,isDirty:_,focusedField:we,lastFocusedField:Ce,dirtyFields:G,get:e,getConfig:at},actionProps:{handleActionClick:ot,handleUndo:Be,handleRedo:Ue,isDisabled:x,isDirty:_,focusedField:we,lastFocusedField:Ce,dirtyFields:G,silentlyGetValidationErrors:ze}}))}else{const i=((i,n,a)=>{let r=!1;if(o.forEach(e=>{a.startsWith(e)&&(r=!0)}),r)return null;if(!v[i.type]&&"subform"!==i.type&&"group"!==i.type)return null;if("function"==typeof i.isRendered&&!i.isRendered(a,n,z,W))return"group"===i.type&&o.push(a),null;if("group"===i.type)return null;const d=Object.assign({},i);if(d.id=a,ge[a])d.options=ge[a];else if("function"==typeof d.options)d.options=d.options(a,n,z);else if("object"==typeof d.computedOptions){let t=e(l,d.computedOptions.source,[]),n=e(z,a);"function"==typeof d.computedOptions.filter&&(t=t.filter(d.computedOptions.filter)),"function"==typeof d.computedOptions.sort&&(t=t.sort(d.computedOptions.sort)),"function"==typeof d.computedOptions.map&&(t=t.map(d.computedOptions.map)),d.computedOptions.initWith&&Array.isArray(d.computedOptions.initWith)&&(t=d.computedOptions.initWith.concat(t)),i.isUnique&&(t=t.map(t=>{if(""===t.value)return t;const o=a.substring(0,a.lastIndexOf("["));let r=e(l,o,[]);return s(r,{[i.id]:t.value})>-1&&t.value!==n?Object.assign({},t,{disabled:!0}):t})),d.options=t,c(t,{value:n})||(d.value="",u(z,a,""))}return delete d.computedValue,delete d.computedOptions,delete d.filter,delete d.clearFields,delete d.dynamicOptions,delete d.isRendered,delete d.defaultValue,delete d.cleanUp,delete d.precision,d.placeholder&&Array.isArray(d.placeholder)&&d.placeholder.length>1&&(void 0===ae[a]&&(ae[a]=d.placeholder[Math.floor(Math.random()*d.placeholder.length)]),d.placeholder=ae[a]),T[i.type]&&"function"==typeof T[i.type].renderer&&!i.errorRenderer&&(d.errorRenderer=T[i.type].renderer),te&&te[a]&&(d.isValidating=!0),Le(i.type)||Object.keys(d).forEach(e=>{"id"!==e&&"function"==typeof d[e]&&e.endsWith("Fn")&&(d[e.substring(0,e.length-2)]=d[e]({path:a,fieldData:n,alldata:z,interfaceState:W}),delete d[e])}),"fieldset"===i.type?null:"subform"!==i.type?/*#__PURE__*/t.createElement(v[i.type].component,Object.assign({key:a,value:(f=n,i.cast&&"function"==typeof i.cast.field?i.cast.field(f):i.cast&&"string"==typeof i.cast.field?Q(f,i.cast.field):i.cast&&Array.isArray(i.cast.field)?Q(f,i.cast.field[0],!0):f),initialValue:e(X,a),error:Ee[a],isDirty:!!G[a],isDisabled:x||i.isDisabled,hasFocus:!(!we||we!==a),onChange:e=>Xe(a,e),onFocus:()=>(t=>{if(!Ie())return;const i=Je(t),n=Object.assign({},z),o=e(n,t);Ae(t),De(t);const a={data:o,fieldIsDirty:!!G[t],fieldConfig:i,fieldHasFocus:!(!we||we!==t)},r=Ge("focus",n,o);if(!i.validateOn&&Array.isArray(A)&&r.some(e=>A.indexOf(e)>-1)||i.validateOn&&Array.isArray(i.validateOn)&&r.some(e=>i.validateOn.indexOf(e)>-1)){const e=We(t,Ke(r),n,Ee);xe(Object.assign({},Ee,e.errors)),He(n,e.errors,j,t)}else if(!i.validateOn&&Array.isArray(A)&&A.indexOf("focus")>-1||i.validateOn&&Array.isArray(i.validateOn)&&i.validateOn.indexOf("focus")>-1||!i.validateOn&&"function"==typeof A&&A(a).indexOf("focus")>-1||i.validateOn&&"function"==typeof i.validateOn&&i.validateOn(a).indexOf("focus")>-1){const e=We(t,"focus",n,Ee);xe(Object.assign({},Ee,e.errors)),He(n,e.errors,j,t)}})(a),onBlur:()=>(t=>{if(!Ie())return;Ae("");const i=Je(t),n=Object.assign({},z),o=Object.assign({},z);let a=e(n,t);oe=0,M()&&window.stagesLogging('Handle blur for field "'+t+'"',$),i.cleanUp&&"function"==typeof i.cleanUp&&void 0!==a&&(a=i.cleanUp(a),u(n,t,a),Xe(t,a,n,!0)),"number"==typeof i.precision&&(u(n,t,Number(a).toFixed(i.precision)),He(n,Ee,j,t));const r={data:a,fieldIsDirty:!!G[t],fieldConfig:i,fieldHasFocus:!(!we||we!==t)},s=Ge("blur",n,a);if(!i.validateOn&&Array.isArray(A)&&s.some(e=>A.indexOf(e)>-1)||i.validateOn&&Array.isArray(i.validateOn)&&s.some(e=>i.validateOn.indexOf(e)>-1)){const e=We(t,Ke(s),n,Ee);xe(Object.assign({},Ee,e.errors)),He(n,e.errors,j,t)}else if(!i.validateOn&&Array.isArray(A)&&A.indexOf("blur")>-1||i.validateOn&&Array.isArray(i.validateOn)&&i.validateOn.indexOf("blur")>-1||!i.validateOn&&"function"==typeof A&&A(r).indexOf("blur")>-1||i.validateOn&&"function"==typeof i.validateOn&&i.validateOn(r).indexOf("blur")>-1){const e=We(t,"blur",n,Ee);xe(Object.assign({},Ee,e.errors)),He(n,e.errors,j,t)}if(Array.isArray(Pe)&&Pe.forEach(e=>{e.config.dynamicOptions&&e.config.dynamicOptions.events&&e.config.dynamicOptions.events.indexOf("blur")>-1&&e.config.dynamicOptions.watchFields&&e.config.dynamicOptions.watchFields.indexOf(i.id)>-1&&_e(e.config.id,e.config.dynamicOptions,n),void 0!==R&&e.config.disableAutoSave&&y(o,e.path)}),(e=>{if(k){const t=[...se];t.length=ce+1,t.push(m({data:e,isDirty:_,dirtyFields:G,errors:Ee})),t.length>F&&t.shift(),le(t),de(t.length-1)}})(n),void 0!==R)if("local"===R||"session"===R){const e=Ne(!1,n);0===Object.keys(e).length&&B(j,{data:o,isDirty:_,dirtyFields:G},R)}else if("object"!=typeof R||"local"!==R.type&&"session"!==R.type){if("object"==typeof R&&"custom"===R.type&&"function"==typeof R.save){const e=Ne(!1,n);(R.validDataOnly&&0===Object.keys(e).length||!R.validDataOnly)&&R.save(j,{data:o,isDirty:_,dirtyFields:G})}}else{const e=Ne(!1,n);(R.validDataOnly&&0===Object.keys(e).length||!R.validDataOnly)&&B(j,{data:o,isDirty:_,dirtyFields:G},R.type)}})(a)},d)):/*#__PURE__*/t.createElement(re,{config:i.config,render:e=>{let{fieldProps:n}=e;/*#__PURE__*/return t.createElement(i.render,n)},fields:v,id:a,onChange:(e,t)=>Xe(a,e),onValidation:e=>$e(a,e),parentRunValidation:fe,data:z&&e(z,a),isVisible:E,isDisabled:x,validateOn:A});var f})(a.config,a.data,a.path);i&&u(n,a.path,i)}}),n},Qe=(t,i,n,o)=>{if(!Ie())return;const a=Object.assign({},z),r=Je(t),s=r&&r.min?Number(r.min):0,l=r&&r.max?Number(r.max):99999999999999;let c,f=e(a,t,[]),p=!1;if("last"===n&&(n=f.length-1),"last"===o&&(o=f.length-1),M()&&window.stagesLogging('On collection action "'+t+'"',$),"add"===i&&("string"==typeof n&&r.fields[n]?l>f.length&&f.push("function"==typeof r.setInitialData?r.setInitialData(f,a,n):{__typename:n}):l>f.length&&f.push("function"==typeof r.setInitialData?r.setInitialData(f,a):{}),p=!0),"remove"===i&&(s<f.length&&f.splice(n,1),p=!0),"move"===i&&"number"==typeof n&&"number"==typeof o&&n>-1&&o>-1){const[e]=f.splice(n,1);f.splice(o,0,e),p=!0}if("sort"===i&&f.length>0&&n&&(f=d(f,n),p=!0),"duplicate"===i&&"number"==typeof n&&n>-1&&(f.splice(n+1,0,Object.assign({},f[n])),p=!0),r.sort&&r.sort.by&&(f=d(f,r.sort.by),"desc"===r.sort.dir&&(f=f.reverse()),p=!0),"update"===i&&Array.isArray(n)?(p=!0,u(a,t,n)):u(a,t,f),p){const i=e(X,t),n=e(a,t);try{JSON.stringify(i)!==JSON.stringify(n)?(J(!0),G[t]={oldData:i,newData:n},K(G)):(delete G[t],Object.keys(G).forEach(e=>{e.startsWith(t)&&delete G[e]}),K(G),J(Object.keys(G).length>0))}catch(e){}}if(A.indexOf("collectionAction")>-1||r.validateOn&&r.validateOn.indexOf("collectionAction")>-1){const e=We(t,"collectionAction",a,Ee);c=Object.assign({},Ee,e.errors),xe(c)}He(a,c||Ne(),j,t)},Ze=(e,t,i)=>{const n=Object.assign({},Ve),o=n[t],a=Je(t);if("step"===e&&(n[t]=i),"next"===e){const e=s(a.stages,{id:o})+1;a.stages[e]&&(n[t]=a.stages[e].id)}if("prev"===e){const e=s(a.stages,{id:o})-1;a.stages[e]&&(n[t]=a.stages[e].id)}"first"===e&&(n[t]=a.stages[0].id),"last"===e&&(n[t]=a.stages[a.stages.length-1].id),Re(n)},et=function(e,t,i){void 0===i&&(i="step");const n=Ve[e],o=Je(e),a=[];if("step"===i||"first"===i||"last"===i)return Object.keys(Ve).forEach(n=>{n.startsWith(e)?("step"===i&&a.push(n+"."+t),"first"===i&&a.push(n+"."+o.stages[0].id),"last"===i&&a.push(n+"."+o.stages[o.stages.length-1].id)):a.push(n+"."+Ve[n])}),"#!"+a.join(L||":");if("prev"===i){const t=s(o.stages,{id:n})-1;return!!o.stages[t]&&(Object.keys(Ve).forEach(i=>{i.startsWith(e)?a.push(i+"."+o.stages[t].id):a.push(i+"."+Ve[i])}),"#!"+a.join(L||":"))}if("next"===i){const t=s(o.stages,{id:n})+1;return!!o.stages[t]&&(Object.keys(Ve).forEach(i=>{i.startsWith(e)?a.push(i+"."+o.stages[t].id):a.push(i+"."+Ve[i])}),"#!"+a.join(L||":"))}return!1},tt=(e,t)=>Ve[e]===t,it=function(e,t,i){void 0===i&&(i=!1);const n=t.substring(2).split(L||":");let o="";if(n.forEach(t=>{t.startsWith(e+".")&&(o=t.substring(e.length+1))}),o){const t=Je(e),n=s(t.stages,{id:o});if(n>s(t.stages,{id:Ve[e]})+1)return!0;if(i&&tt(e,o))return!0;for(let i=0;i<n;i++){const n=Ne(!1,l,e+"."+t.stages[i].id);if(Object.keys(n).length>0)return!0}}return!1},nt=(t,i,n)=>{if(r.fieldConfigs&&"function"==typeof r.fieldConfigs[i]){const o=t.split(".");let a="";o.forEach(t=>{const i=a?e(Te,a):Te;if(t.endsWith("]")){const e=t.split("["),n=s(i,{id:e[0]});n>-1&&(a+="["+n+"].fields")}else{const e=s(i,{id:t});e>-1&&(a+="["+e+"].fields")}}),""!==a&&(ke.push({fields:r.fieldConfigs[i],path:a,action:n}),Fe([...ke]))}},ot=(e,t,i)=>{M()&&window.stagesLogging("Handle action click",$),i&&("local"!==R&&"session"!==R||U(j,R),"object"!=typeof R||"local"!==R.type&&"session"!==R.type||U(j,R.type),j&&"object"==typeof R&&"custom"===R.type&&"function"==typeof R.remove&&R.remove(j),He(X,Ne(),j),K({}),J(!1));const n=Ge("action",z);let o=!1;if(Array.isArray(A)&&A.indexOf("action")>-1||Array.isArray(A)&&n.some(e=>A.indexOf(e)>-1)){t&&(pe(!0),setTimeout(()=>pe(!1),0));let e=t?Ne(!0):{};xe(e),Object.keys(e).length>0&&(o=!0)}o||e()},at=e=>{const t=c(Pe,{path:e});return t?t.config:void 0};return!1===E?null:h?h({actionProps:{handleActionClick:ot,handleUndo:Be,handleRedo:Ue,isDisabled:!!(te&&Object.keys(te).length>0)||x,isDirty:_,focusedField:we,lastFocusedField:Ce,dirtyFields:G,silentlyGetValidationErrors:ze,updateData:t=>{He(t,Ne(),j);let i=!1,n={};Pe.forEach(o=>{if(!o.config.isInterfaceState){const a=e(t,o.path),r=e(X,o.path);a!==r&&(i=!0,void 0!==a&&(n[o.path]={oldData:r,newData:a}))}}),J(i),K(n)}},fieldProps:{fields:Ye(),onCollectionAction:Qe,onWizardNav:Ze,getWizardNavHash:et,isWizardStepActive:tt,isWizardStepDisabled:it,modifyConfig:nt,data:l,interfaceState:W,errors:Ee,asyncData:ve,isDirty:_,focusedField:we,lastFocusedField:Ce,dirtyFields:G,get:e,getConfig:at},loading:je}):b?b(Ye()):null};re.propTypes={config:_.oneOfType([_.object,_.array,_.func]).isRequired,data:_.object,render:_.oneOfType([_.node,_.func]),renderFields:_.oneOfType([_.node,_.func]),fields:_.object.isRequired,onChange:_.func,isVisible:_.bool,isDisabled:_.bool,id:_.oneOfType([_.string,_.number]),onValidation:_.func,parentRunValidation:_.bool,validateOn:_.array,customRuleHandlers:_.object,undoMaxDepth:_.number,typeValidations:_.object,fieldsets:_.object,initialInterfaceState:_.object},re.defaultProps={data:{},onChange:()=>{},isVisible:!0,isDisabled:!1,validateOn:["action"],customRuleHandlers:{},undoMaxDepth:10,autoSave:!1,typeValidations:{},fieldsets:{},initialInterfaceState:{}};const se=e=>{let{config:i,handleActionClick:n,isDisabled:o}=e;/*#__PURE__*/return t.createElement(t.Fragment,null,i.map((e,i)=>/*#__PURE__*/t.createElement("button",{type:"button",onClick:()=>n(e.onClick,e.validate),key:"action-"+i,disabled:o},"primary"===e.type?/*#__PURE__*/t.createElement("strong",null,e.title):e.title)))};function le(e,t){if(null==e)return{};var i,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(i=a[n])>=0||(o[i]=e[i]);return o}const ce=["id","label","value","onChange","onBlur","onFocus","error","placeholder","isRequired","isDisabled","isValidating","hasFocus","prefix","suffix","secondaryText","type","errorRenderer"],de=e=>{let{id:i,label:n,value:o,onChange:a,onBlur:r,onFocus:s,error:l,placeholder:c,isRequired:d,isDisabled:f,isValidating:p,prefix:u,suffix:y,secondaryText:g,type:m,errorRenderer:h}=e;return le(e,ce),console.log({id:i,value:o}),/*#__PURE__*/t.createElement("div",null,n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,d?" *":""):null,/*#__PURE__*/t.createElement("div",null,u?/*#__PURE__*/t.createElement("span",null,u):null,/*#__PURE__*/t.createElement("input",{id:i,name:i,value:void 0!==o?o:"number"===m?0:"",placeholder:c,type:m||"text",disabled:!!f,required:!!d,autoComplete:"password"===m?"current-password":"off",onChange:e=>{"function"==typeof a&&a(e.target.value)},onFocus:e=>{"function"==typeof s&&s()},onBlur:e=>{"function"==typeof r&&r()}}),y?/*#__PURE__*/t.createElement("span",null,y):null),g?/*#__PURE__*/t.createElement("div",null,g):null,l&&!p?h?h(l):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,p?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},fe=(e,t)=>!t.isRequired||""!==e&&void 0!==e,pe=["id","label","value","onChange","onBlur","onFocus","error","placeholder","isRequired","isDisabled","isValidating","prefix","suffix","secondaryText","type","errorRenderer"],ue=["id","label","value","options","onChange","onBlur","onFocus","error","placeholder","isRequired","isDisabled","isValidating","prefix","suffix","secondaryText","errorRenderer"],ye=["id","label","value","options","onChange","onBlur","onFocus","error","isRequired","isDisabled","isValidating","prefix","suffix","secondaryText","errorRenderer"],ge=["id","label","error","isRequired","isValidating","secondaryText","errorRenderer"],me={text:{component:de,isValid:fe},number:{component:de,isValid:fe},email:{component:de,isValid:fe},password:{component:de,isValid:fe},tel:{component:de,isValid:fe},time:{component:de,isValid:fe},date:{component:de,isValid:fe},checkbox:{component:e=>{let{id:i,label:n,value:o,onChange:a,onBlur:r,onFocus:s,error:l,placeholder:c,isRequired:d,isDisabled:f,isValidating:p,prefix:u,suffix:y,secondaryText:g,type:m,errorRenderer:h}=e;return le(e,pe),/*#__PURE__*/t.createElement("div",null,n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,d?" *":""):null,/*#__PURE__*/t.createElement("div",null,u?/*#__PURE__*/t.createElement("span",null,u):null,/*#__PURE__*/t.createElement("input",{id:i,name:i,value:"1",placeholder:c,type:m,disabled:!!f,required:!!d,checked:!!o,onChange:()=>{},onClick:e=>{"function"==typeof a&&a(!!e.target.checked)},onBlur:e=>{"function"==typeof r&&r()},onFocus:e=>{"function"==typeof s&&s()}}),y?/*#__PURE__*/t.createElement("span",null,y):null),g?/*#__PURE__*/t.createElement("div",null,g):null,l&&!p?h?h(l):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,p?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},isValid:(e,t)=>!t.isRequired||""!==e&&void 0!==e},select:{component:e=>{let{id:i,label:n,value:o,options:a,onChange:r,onBlur:s,onFocus:l,error:c,placeholder:d,isRequired:f,isDisabled:p,isValidating:u,prefix:y,suffix:g,secondaryText:m,errorRenderer:h}=e;return le(e,ue),/*#__PURE__*/t.createElement("div",null,n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,f?" *":""):null,/*#__PURE__*/t.createElement("div",null,y?/*#__PURE__*/t.createElement("span",null,y):null,/*#__PURE__*/t.createElement("select",{id:i,name:i,value:void 0===o?"":o,placeholder:d,disabled:!!p,required:!!f,onChange:e=>{"function"==typeof r&&r(e.target.value)},onBlur:e=>{"function"==typeof s&&s()},onFocus:e=>{"function"==typeof l&&l()}},a.map(e=>/*#__PURE__*/t.createElement("option",{value:e.value,key:e.value,disabled:!!e.disabled||null},e.text))),g?/*#__PURE__*/t.createElement("span",null,g):null),m?/*#__PURE__*/t.createElement("div",null,m):null,c&&!u?h?h(c):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,u?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},isValid:(e,t)=>!t.isRequired||""!==e&&void 0!==e},radio:{component:e=>{let{id:i,label:n,value:o,options:a,onChange:s,onBlur:l,onFocus:c,error:d,isRequired:f,isDisabled:p,isValidating:u,prefix:y,suffix:g,secondaryText:m,errorRenderer:h}=e;return le(e,ye),/*#__PURE__*/t.createElement("div",{id:i},n?/*#__PURE__*/t.createElement("label",null,n,f?" *":""):null,/*#__PURE__*/t.createElement("div",null,y?/*#__PURE__*/t.createElement("span",null,y):null,a.map(e=>/*#__PURE__*/t.createElement(r,{key:i+"-"+e.value},/*#__PURE__*/t.createElement("input",{type:"radio",name:i,id:i+"-"+e.value,value:e.value,checked:o===e.value,disabled:!!p,onChange:()=>{},onClick:t=>{"function"==typeof s&&s(e.value)},onBlur:e=>{"function"==typeof l&&l()},onFocus:e=>{"function"==typeof c&&c()}}),/*#__PURE__*/t.createElement("label",{htmlFor:i+"-"+e.value},e.text)," ")),g?/*#__PURE__*/t.createElement("span",null,g):null),m?/*#__PURE__*/t.createElement("div",null,m):null,d&&!u?h?h(d):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,u?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},isValid:(e,t)=>!t.isRequired||""!==e&&void 0!==e},dummy:{component:e=>{let{id:i,label:n,error:o,isRequired:a,isValidating:r,secondaryText:s,errorRenderer:l}=e;return le(e,ge),n||s||o?/*#__PURE__*/t.createElement("div",{id:i},n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,a?" *":""):null,s?/*#__PURE__*/t.createElement("div",null,s):null,o&&!r?l?l(o):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,r?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null):null},isValid:()=>!0}};export{se as Actions,Y as Debugger,re as Form,G as HashRouter,K as Navigation,X as Progression,J as Stages,me as plainFields};
//# sourceMappingURL=lib.module.js.map

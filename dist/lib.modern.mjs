import e from"lodash/get";export{default as get}from"lodash/get";import"core-js/modules/es.array.iterator.js";import"core-js/modules/es.object.assign.js";import"core-js/modules/web.dom-collections.iterator.js";import t,{useState as i,useEffect as n,useCallback as o,useRef as a,Fragment as r}from"react";import s from"lodash/findindex";import"core-js/modules/es.json.stringify.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.string.split.js";import l from"json-beautify";import"core-js/modules/es.array.reverse.js";import"core-js/modules/es.array.sort.js";import"core-js/modules/es.number.to-fixed.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.regexp.constructor.js";import"core-js/modules/es.regexp.test.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.string.starts-with.js";import c from"lodash/find";import d from"lodash/sortby";import f from"lodash/uniqwith";import p from"lodash/isequal";import u from"lodash/set";import y from"lodash/unset";import g from"lodash/merge";import m from"fast-json-stable-stringify";function h(e){var t={exports:{}};return e(t,t.exports),t.exports}var b="function"==typeof Symbol&&Symbol.for,v=b?Symbol.for("react.element"):60103,O=b?Symbol.for("react.portal"):60106,E=b?Symbol.for("react.fragment"):60107,x=b?Symbol.for("react.strict_mode"):60108,j=b?Symbol.for("react.profiler"):60114,S=b?Symbol.for("react.provider"):60109,w=b?Symbol.for("react.context"):60110,A=b?Symbol.for("react.async_mode"):60111,$=b?Symbol.for("react.concurrent_mode"):60111,C=b?Symbol.for("react.forward_ref"):60112,D=b?Symbol.for("react.suspense"):60113,k=b?Symbol.for("react.suspense_list"):60120,F=b?Symbol.for("react.memo"):60115,V=b?Symbol.for("react.lazy"):60116,R=b?Symbol.for("react.block"):60121,T=b?Symbol.for("react.fundamental"):60117,I=b?Symbol.for("react.responder"):60118,L=b?Symbol.for("react.scope"):60119;function q(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case v:switch(e=e.type){case A:case $:case E:case j:case x:case D:return e;default:switch(e=e&&e.$$typeof){case w:case C:case V:case F:case S:return e;default:return t}}case O:return t}}}function P(e){return q(e)===$}var W={AsyncMode:A,ConcurrentMode:$,ContextConsumer:w,ContextProvider:S,Element:v,ForwardRef:C,Fragment:E,Lazy:V,Memo:F,Portal:O,Profiler:j,StrictMode:x,Suspense:D,isAsyncMode:function(e){return P(e)||q(e)===A},isConcurrentMode:P,isContextConsumer:function(e){return q(e)===w},isContextProvider:function(e){return q(e)===S},isElement:function(e){return"object"==typeof e&&null!==e&&e.$$typeof===v},isForwardRef:function(e){return q(e)===C},isFragment:function(e){return q(e)===E},isLazy:function(e){return q(e)===V},isMemo:function(e){return q(e)===F},isPortal:function(e){return q(e)===O},isProfiler:function(e){return q(e)===j},isStrictMode:function(e){return q(e)===x},isSuspense:function(e){return q(e)===D},isValidElementType:function(e){return"string"==typeof e||"function"==typeof e||e===E||e===$||e===j||e===x||e===D||e===k||"object"==typeof e&&null!==e&&(e.$$typeof===V||e.$$typeof===F||e.$$typeof===S||e.$$typeof===w||e.$$typeof===C||e.$$typeof===T||e.$$typeof===I||e.$$typeof===L||e.$$typeof===R)},typeOf:q};function N(){}function z(){}h(function(e,t){}),h(function(e){e.exports=W}),z.resetWarningCache=N;var _=h(function(e){e.exports=function(){function e(e,t,i,n,o,a){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==a){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:z,resetWarningCache:N};return i.PropTypes=i,i}()});const H=(e,t,i="stages-form-")=>{if("local"===t&&"undefined"!=typeof localStorage||"session"===t&&"undefined"!=typeof sessionStorage){const t=localStorage.getItem(`${i}${e}`)||"{}";let n={};try{n=JSON.parse(t)}catch(e){}return n}return{}},B=(e,t={},i,n="stages-form-")=>{if(("local"===i&&"undefined"!=typeof localStorage||"session"===i&&"undefined"!=typeof sessionStorage)&&"object"==typeof t){let i="{}";try{i=JSON.stringify(t)}catch(e){}localStorage.setItem(`${n}${e}`,i)}},U=(e,t,i="stages-form-")=>{("local"===t&&"undefined"!=typeof localStorage||"session"===t&&"undefined"!=typeof sessionStorage)&&localStorage.removeItem(`${i}${e}`)},M=()=>"undefined"!=typeof window&&"function"==typeof window.stagesLogging,J=({children:e,initialData:t,initialStep:o,render:a,validateOnStepChange:r,onChange:l,autoSave:c,id:d})=>{const[f]=i(`stages-${d||+new Date}`),[p,u]=i((()=>{if(!d||"local"!==c&&"session"!==c&&("object"!=typeof c||"local"!==c.type&&"session"!==c.type)){if(d&&"object"==typeof c&&"custom"===c.type&&"function"==typeof c.get){const e=c.get(d);if(Object.keys(e).length>0)return e}}else{const e=H(d,"object"==typeof c?c.type:c);if(Object.keys(e).length>0)return e}return t})()),[y,g]=i([]),[m,h]=i({}),[b,v]=i(o||0),[O,E]=i([]),x=e=>{const t=O&&O[e]?O[e].key:e;return p&&p[t]?p[t]:{}},j=(e,t)=>(O[t]||(O[t]={key:e,visible:!0},E([...O])),e),S=(e,t,i)=>{const n=Object.assign({},p),o=O&&O[i]?O[i].key:i;M()&&window.stagesLogging(`Handle onChange for "${o}"`,f),m[i]=t,h(Object.assign({},m)),n[o]=e,p[o]=e,u(Object.assign({},n)),"function"==typeof l&&l({data:n,errors:m}),d&&("local"===c||"session"===c?0===Object.keys(m).length&&B(d,n,c):"object"!=typeof c||"local"!==c.type&&"session"!==c.type?d&&"object"==typeof c&&"custom"===c.type&&"function"==typeof c.save&&(c.validDataOnly&&0===Object.keys(m).length||!c.validDataOnly)&&c.save(d,n):(c.validDataOnly&&0===Object.keys(m).length||!c.validDataOnly)&&B(d,n,c.type))},w=()=>{d&&("local"!==c&&"session"!==c||U(d,c),"object"!=typeof c||"local"!==c.type&&"session"!==c.type||U(d,c.type),d&&"object"==typeof c&&"custom"===c.type&&"function"==typeof c.remove&&c.remove(d)),u(t),v(0),"function"==typeof l&&l({data:t,errors:m})};n(()=>{M()&&(!d||"local"!==c&&"session"!==c&&("object"!=typeof c||"local"!==c.type&&"session"!==c.type)?d&&"object"==typeof c&&"custom"===c.type&&"function"==typeof c.get?window.stagesLogging({id:f,keys:O,data:p,initialData:t,initialStep:o,errors:m,currentStep:b,savedData:c.get(d)}):window.stagesLogging({id:f,keys:O,data:p,initialData:t,initialStep:o,errors:m,currentStep:b,savedData:{}}):window.stagesLogging({id:f,keys:O,data:p,initialData:t,initialStep:o,errors:m,currentStep:b,savedData:H(d,"object"==typeof c?c.type:c)}))},[O,p,m,b]),n(()=>{M()&&window.stagesLogging("Init Stages",f),e.map((e,t)=>e({index:t,setStepKey:j,initializing:!0})).filter(e=>e)},[]),n(()=>{if(r){const e=$();e<b&&v(-1===e?0:e+1)}g(e.map((e,t)=>e({data:x(t),allData:p,onChange:S,reset:w,onNav:A,isActive:t===b,index:t,errors:m[t]||{},setStepKey:j})).filter((e,t)=>{const i=null!==e;return O[t]&&(O[t].visible=i),i}))},[b,p]);const A=(e,t)=>{let i=b;if(M()&&window.stagesLogging(`On nav "${e}" -> "${t}"`,f),"next"===e){let e=!1;for(let t=b+1;t<O.length;t++)O[t].visible&&!e&&(i=t,e=!0)}if("prev"===e){let e=!1;for(let t=b-1;t>=0;t--)O[t].visible&&!e&&(i=t,e=!0)}if("first"===e){let e=!1;for(let t=0;t<O.length;t++)O[t].visible&&!e&&(i=t,e=!0)}if("last"===e){let e=!1;for(let t=O.length-1;t>=0;t--)O[t].visible&&!e&&(i=t,e=!0)}if("lastValid"===e&&(i=$()),"step"===e&&O[t]&&O[t].visible)i=Number(t);else if("step"===e&&"string"==typeof t){const e=s(O,{key:t});e>-1&&(i=e)}i<0&&(i=0),i>O.length&&(i=O.length),v(i)},$=()=>{let e=-1,t=!1;return Object.keys(m).forEach(i=>{const n=s(O,{key:i});(0===Object.keys(m[i]).length||n>-1&&!O[n].visible)&&!t?e=Number(i):t=!0}),e};return 0===y.length?null:a?a({navigationProps:{currentStep:b,data:p,onChangeStep:e=>{const t=$();M()&&window.stagesLogging(`On change step "${e}"`,f),("number"==typeof t&&"number"==typeof e&&t+1>=e||!1===r)&&v(e)},errors:m,keys:O,stepCount:y.length,lastValidStep:$(),reset:w},progressionProps:(()=>{const e=y.length,t=$();let i=0;return Object.keys(m).forEach((e,n)=>{const o=x(n);n<=t&&0===Object.keys(m[n]).length&&Object.keys(o).length>0&&i++}),{currentStep:b,stepCount:e,validSteps:i,percentage:100/e*i,data:p,errors:m}})(),routerProps:{step:b,onChange:v,keys:O},steps:y}):null};J.propTypes={children:_.arrayOf(_.oneOfType([_.node,_.func])).isRequired,initialData:_.object,render:_.oneOfType([_.node,_.func]).isRequired,initialStep:_.number,validateOnStepChange:_.bool,id:_.oneOfType([_.string,_.number])},J.defaultProps={initialData:{},validateOnStepChange:!0,autoSave:!1};const G=({step:e,onChange:t,keys:a,prefix:r,hashFormat:l="#!"})=>{const[c,d]=(()=>{const[e,t]=i(()=>window.location.hash),a=o(()=>{t(window.location.hash)},[]);var r,s;r=()=>{((e,...t)=>{e&&e.addEventListener&&e.addEventListener(...t)})(window,"hashchange",a)},s=()=>{((e,...t)=>{e&&e.removeEventListener&&e.removeEventListener(...t)})(window,"hashchange",a)},n(()=>(r&&r(),()=>{s&&s()}),[]);const l=o(t=>{t!==e&&(window.location.hash=t)},[e]);return[e,l]})(),[f,p]=i(!1),u=e=>a&&a[e]?a[e].key:r?`${r}-${e}`:e,y=()=>{if("string"==typeof c&&-1!==c.indexOf(l)){const e=(e=>{const t=e.split(l);if(2===t.length){const e=t[1];return(e=>{var t=Math.floor(Number(e));return Infinity!==t&&String(t)===e&&t>=0})(e)?Number(e):s(a,{key:e})}return-1})(c);-1!==e&&("function"==typeof d&&d(`${l}${u(e)}`),t(e))}else"function"==typeof d&&d(`${l}${u(e)}`)};return n(()=>{f&&y()},[c]),n(()=>{f&&"function"==typeof d&&d(`${l}${u(e)}`)},[e]),g=()=>{y(),p(!0)},n(()=>{g()},[]),null;var g},K=({currentStep:e,onChangeStep:i,lastValidStep:n,keys:o})=>{const a=[];for(let r=0;r<o.length;r++)if(o&&o[r]&&o[r].visible){const s=o&&o[r]?o[r].key:`Step ${r+1}`;a.push(e===r?/*#__PURE__*/t.createElement("li",{key:s,style:{textTransform:"capitalize"}},/*#__PURE__*/t.createElement("strong",null,s)):/*#__PURE__*/t.createElement("li",n>-1&&n+1<r||-1===n&&r>0?{key:s,style:{color:"#999",textTransform:"capitalize"}}:{key:s,style:{textTransform:"capitalize"},onClick:()=>i(r)},s))}/*#__PURE__*/return t.createElement("ul",null,a)},X=({stepCount:e,validSteps:i,percentage:n})=>/*#__PURE__*/t.createElement("div",null,`${i} / ${e} (${Math.round(n)}%)`),Y=()=>{const[o,a]=i({}),[r,s]=i({}),[c,d]=i({}),[f,p]=i({}),[u,y]=i(!1),g=(e,t)=>{if("string"==typeof e)r[t]||(r[t]=[]),r[t].push({action:e,time:+new Date}),s(r);else{const t=Object.assign(o,{}),i=Object.keys(t)[0];t[e.id]=e,a(Object.assign({},t)),d(e=>({key:e.key?e.key:i,tab:e.tab?e.tab:"data"}))}};return n(()=>{"undefined"!=typeof window&&(window.stagesLogging=g)},[]),0===Object.keys(o).length?null:/*#__PURE__*/t.createElement("div",{style:{position:"absolute",top:"8px",right:"8px",width:"320px",padding:"8px",fontSize:"14px",color:"#333",border:"1px #bbb solid",borderRadius:"4px",background:"#fbfbfb",fontFamily:"Open Sans, Helvetica, Arial, sans",zIndex:1e3}},/*#__PURE__*/t.createElement("strong",{style:{lineHeight:"22px"}},"Debugger:"),/*#__PURE__*/t.createElement("button",{type:"button",style:{float:"right"},onClick:()=>y(!u)},u?"hide":"show"),u?Object.keys(o).map(i=>{const n=i.split("-");n.pop();let a="";return a="logs"===c.tab?r[c.key]?r[c.key].map(e=>`${e.time}: ${e.action}`).join("\n"):"":l(f[i]?e(o[c.key][c.tab],f[i]||""):o[c.key][c.tab],null,2),/*#__PURE__*/t.createElement("div",{key:`${i}-${c.tab}`},/*#__PURE__*/t.createElement("h3",{style:{background:"#333",color:"#fff",margin:"8px 0 0 0",padding:"2px 6px",textTransform:"capitalize",position:"relative"}},n.join(" "),":",o[i].isDirty?/*#__PURE__*/t.createElement("span",{style:{display:"inline-block",position:"absolute",top:"5px",right:"4px",background:"#f30",color:"#fff",fontSize:"11px",padding:"1px 4px"}},"dirty"):null,Object.keys(o[i].errors).length?/*#__PURE__*/t.createElement("span",{style:{display:"inline-block",position:"absolute",top:"5px",right:"48px",background:"#f30",color:"#fff",fontSize:"11px",padding:"1px 4px"}},"errors"):null,o[i].loading?/*#__PURE__*/t.createElement("span",{style:{display:"inline-block",position:"absolute",top:"5px",right:"98px",background:"#f30",color:"#fff",fontSize:"11px",padding:"1px 4px"}},"loading"):null),/*#__PURE__*/t.createElement("div",null,/*#__PURE__*/t.createElement("select",{onChange:e=>d({key:i,tab:e.target.value}),value:c.key===i?c.tab:"data",style:{width:"47%",minWidth:"47%",maxWidth:"47%",marginRight:"2%",height:"25px"}},o[i].keys?/*#__PURE__*/t.createElement(t.Fragment,null,/*#__PURE__*/t.createElement("option",{value:"data"},"Data"),/*#__PURE__*/t.createElement("option",{value:"errors"},"Errors"),/*#__PURE__*/t.createElement("option",{value:"initialData"},"Initial Data"),/*#__PURE__*/t.createElement("option",{value:"savedData"},"Saved Data"),/*#__PURE__*/t.createElement("option",{value:"keys"},"Keys"),/*#__PURE__*/t.createElement("option",{value:"logs"},"Logs")):/*#__PURE__*/t.createElement(t.Fragment,null,/*#__PURE__*/t.createElement("option",{value:"data"},"Data"),/*#__PURE__*/t.createElement("option",{value:"errors"},"Errors"),/*#__PURE__*/t.createElement("option",{value:"parsedFieldConfig"},"Field Config"),/*#__PURE__*/t.createElement("option",{value:"initialData"},"Initial Data"),/*#__PURE__*/t.createElement("option",{value:"interfaceState"},"Interface State"),/*#__PURE__*/t.createElement("option",{value:"undoData"},"Undo Data"),/*#__PURE__*/t.createElement("option",{value:"asyncData"},"Async Data"),/*#__PURE__*/t.createElement("option",{value:"savedData"},"Saved Data"),/*#__PURE__*/t.createElement("option",{value:"fieldPaths"},"Field Paths"),/*#__PURE__*/t.createElement("option",{value:"logs"},"Logs"))),/*#__PURE__*/t.createElement("input",{value:f[i]||"",placeholder:"your.data.filter.path",onChange:e=>{const t=Object.assign({},f);t[i]=e.target.value,p(t)},style:{width:"47%",minWidth:"47%",maxWidth:"47%",fontSize:"12px",border:"1px #ccc solid",background:"#fbfbfb",marginTop:"4px",padding:"4px",overflowX:"scroll",whiteSpace:"pre"}})),c&&c.key===i?/*#__PURE__*/t.createElement("textarea",{readOnly:!0,style:{width:"calc(100% - 8px)",minWidth:"calc(100% - 8px)",maxWidth:"calc(100% - 8px)",height:"200px",fontSize:"10px",border:"1px #ccc solid",background:"#fbfbfb",marginTop:"8px",overflowX:"scroll",whiteSpace:"pre"},value:a}):null)}):null)},Q=(e,t,i)=>i&&Array.isArray(e)?"number"===t?e.map(e=>Number(e)):"string"===t?e.map(e=>String(e)):"boolean"===t?e.map(e=>Boolean(e)):"date"===t?e.map(e=>new Date(e)):e:"number"===t?Number(e):"string"===t?String(e):"boolean"===t?Boolean(e):"date"===t?new Date(e):e,Z=(e,t)=>{const i={};return Object.keys(t).forEach(n=>{i[n]=void 0!==e[n]?e[n]:t[n].default,void 0===e[n]&&t[n].required&&console.warn(`Param "${n}" is required but is missing in field configs!`),void 0!==e[n]&&typeof e[n]!==t[n].type&&console.warn(`Param "${n}" is not of type "${t[n].type}"!`)}),i},ee={};let te,ie,ne,oe=0;const ae={},re=({config:o,data:r,render:l,renderFields:h,fields:b,onChange:v,isVisible:O,isDisabled:E,id:x,onValidation:j,parentRunValidation:S,validateOn:w,throttleWait:A,customEvents:$,enableUndo:C,undoMaxDepth:D,customRuleHandlers:k,autoSave:F,typeValidations:V,fieldsets:R,initialInterfaceState:T,hashSeparator:I})=>{const L=a(!1),[q,P]=i(T),W=Object.assign({},r);g(W,q);const[N]=i(`form-${x||"noid"}-${+new Date}`),[z,_]=i(!1),[J,G]=i({}),[K,X]=i(!1),[Y,se]=i([]),[le,ce]=i(0),[de,fe]=i(!1),[pe,ue]=i(!1),[ye,ge]=i({}),[me,he]=i({}),[be,ve]=i(),[Oe,Ee]=i({}),[xe,je]=i(!1),[Se,we]=i(""),[Ae,$e]=i(""),[Ce,De]=i([]),[ke,Fe]=i({}),Ve=((t,i,n,o,a,r)=>{let l="function"==typeof t.fields?t.fields(i,n,o):"function"==typeof t?t(i,n,o):Array.isArray(t)?t:[];const c=e=>{if("string"==typeof e&&t.fieldConfigs&&"function"==typeof t.fieldConfigs[e])return t.fieldConfigs[e](i,n,o);if("object"==typeof e&&t.fieldConfigs&&"function"==typeof t.fieldConfigs[e.type]){const a=t.fieldConfigs[e.type](i,n,o);return Object.assign({},a,e,{type:a.type})}return"object"==typeof e&&r[e.type]?{id:e.id,type:"fieldset",fieldset:e.type,fields:r[e.type].config({data:i,asyncData:n,interfaceState:o,params:Z(e.params||{},r[e.type].params)}),params:e.params}:"function"==typeof e?e(i,n,o):e};return l=l.map(e=>("object"!=typeof e||"group"!==e.type&&"collection"!==e.type&&"fieldset"!==e.type||!Array.isArray(e.fields)||(e.fields=e.fields.map(e=>c(e))),"object"==typeof e&&"wizard"===e.type&&Array.isArray(e.stages)&&(e.stages=e.stages.map(e=>c(e))),c(e))),a.forEach(t=>{const o=e(l,t.path);if(Array.isArray(o)){if("add"===t.action&&o.push(t.fields(i,n)),"remove"===t.action){const e=t.fields(i,n),a=s(o,{id:e.id});a>-1&&o.splice(a,1)}u(l,t.path,o)}}),l})(o,W,be,q,Ce,R),Re=((t,i,n)=>{const o=[],a=(r="",s="",l="")=>{let c=[r?e(t,r):t],d=[];Array.isArray(c[0])||(d=Object.keys(c[0]),c=Object.values(c[0])),("stage"!==l||((e,t)=>{let i=!1;return Object.keys(e).forEach(n=>{`${n}.${e[n]}`===t&&(i=!0)}),i})(n,s))&&c.forEach((t,n)=>{const l=void 0!==d[n]?d[n]:void 0;Array.isArray(t)&&t.forEach((t,n)=>{const c=s?`${s}.${t.id}`:t.id,d=e(i,c),f=e(i,s);if((l&&f&&f.__typename===l||!l)&&o.push({path:c,config:t,data:d}),"collection"===t.type){const o=s?e(i,`${s}.${t.id}`):i[t.id];o&&Array.isArray(o)&&o.forEach((e,i)=>{a(`${r}[${n}].fields`,s?`${s}.${t.id}[${i}]`:`${t.id}[${i}]`)})}else"group"===t.type||"fieldset"===t.type||"stage"===t.type?a(`${r}[${n}].fields`,c,t.type):"wizard"===t.type&&a(`${r}[${n}].stages`,c,"wizard")})})};return a(),o})(Ve,W,ke);n(()=>(L.current=!0,()=>{L.current=!1}),[]),n(()=>{const e=("undefined"!=typeof window?window.location.hash.substring(2):"").split(I||":"),t=Object.assign({},ke);e.forEach(e=>{const i=e.split("."),n=i.slice(0,-1).join("."),o=i[i.length-1];n&&o&&(t[n]=o)}),Re.forEach(e=>{"wizard"!==e.config.type||t[e.path]&&(!t[e.path]||c(e.config.stages,{id:t[e.path]}))||(t[e.path]=e.config.stages[0].id)}),JSON.stringify(ke)!==JSON.stringify(t)&&Fe(t)},[o]);const Te=()=>L&&!0===L.current;n(()=>{if(r&&!K){let t;M()&&window.stagesLogging("Set initial data",N),Re.forEach(i=>{if(void 0!==i.config.defaultValue&&void 0===e(r,i.path)){const e="function"==typeof i.config.defaultValue?i.config.defaultValue(r):i.config.defaultValue;u(r,i.path,e),u(W,i.path,e)}if(Array.isArray(i.config.validateOn)&&i.config.validateOn.indexOf("init")>-1||Array.isArray(w)&&w.indexOf("init")>-1){const e=qe(i.path,"init",r,Oe);t=Object.assign({},Oe,e)}t&&Ee(t)});const i=m(r);let n;X(JSON.parse(i)),"local"===F||"session"===F||"object"==typeof F&&("local"===F.type||"session"===F.type)?n=H(x,"object"==typeof F?F.type:F):x&&"object"==typeof F&&"custom"===F.type&&"function"==typeof F.get&&(n=F.get(x)),n&&Object.keys(n).length>0&&setTimeout(()=>{_(!!n.isDirty),G("object"==typeof n.dirtyFields?n.dirtyFields:{}),_e(n.data,Pe(!1,n.data),x)},0)}},[r]),n(()=>{if(M()){let e;e="local"===F||"session"===F||"object"==typeof F&&("local"===F.type||"session"===F.type)?H(x,"object"==typeof F?F.type:F):x&&"object"==typeof F&&"custom"===F.type&&"function"==typeof F.get?F.get(x):{},window.stagesLogging({id:N,data:r,initialData:K,interfaceState:q,undoData:Y,asyncData:be,errors:Oe,fieldPaths:Re,isDirty:z,focusedField:Se,lastFocusedField:Ae,dirtyFields:J,loading:xe,parsedFieldConfig:Ve,savedData:e})}},[r,Oe,z,Se,Ae,J,xe]);const Ie=e=>"collection"===e||"subform"===e||"group"===e||"fieldset"===e||"config"===e||"wizard"===e||"stage"===e,Le=(t,i,n,o)=>{if(!b[i.type])return!0;const a=e(n,t),r=!Ie(i.type)&&b[i.type].isValid(a,i);if(V[i.type]&&"function"==typeof V[i.type].validation&&!i.customValidation)return V[i.type].validation({data:a,allData:n,interfaceState:q,fieldConfig:i,isValid:r,fieldHasFocus:!(!Se||Se!==t),fieldIsDirty:void 0!==J[t],triggeringEvent:o});if(("string"==typeof i.regexValidation||i.regexValidation instanceof RegExp)&&!i.customValidation){let e;if("string"==typeof i.regexValidation)try{e=new RegExp(i.regexValidation)}catch(e){}else e=i.regexValidation;return r&&(e.test(a)||!a)}if(!Ie(i.type)&&"function"==typeof i.customValidation){const e=i.customValidation({data:a,allData:n,interfaceState:q,fieldConfig:i,isValid:r,fieldHasFocus:!(!Se||Se!==t),fieldIsDirty:void 0!==J[t],triggeringEvent:o});if(!function(e){return e&&"[object Promise]"===Object.prototype.toString.call(e)}(e))return e;!function(){const n=+new Date;te=Object.assign({},te,{[t]:n}),e.then(e=>{te[t]===n&&(!0!==e?(delete te[t],Ee(Object.assign({},Oe,{[t]:{field:i}}))):(delete te[t],Ee(Object.assign({},Oe))),te=Object.assign({},te))})}()}return r},qe=(t,i,n,o,a)=>{const r=c(Re,{path:t}).config;M()&&"render"!==i&&window.stagesLogging(`Validate field "${t}"`,N);const s=Le(t,r,n,i),l=e(n,t);return o[t]&&delete o[t],Ie(r.type)||!0===s?"collection"===r.type&&r.isRequired&&(!l||0===l.length||1===l.length&&0===Object.keys(l[0]).length)?(a||(a=t),o[t]={value:l,field:r}):"collection"===r.type&&(Array.isArray(r.fields)?r.fields.forEach(a=>{l&&l.forEach((s,c)=>{const d=`${t}[${c}].${a.id}`;if(!(r.isRequired||s&&0!==Object.keys(s).length))return;const f=Le(a,d,s,i);if(b[a.type]&&!0!==f)o[t]={value:l,subField:a,errorCode:!1!==f?f:void 0};else if(b[a.type]&&a.isUnique){let i=e(n,t,[]).filter(e=>void 0!==e[a.id]).map(e=>e[a.id]);[...new Set(i)].length!==i.length&&(o[t]={value:l,subField:a,errorCode:"notUnique"})}})}):l&&l.forEach((e,n)=>{(r.isRequired||e&&0!==Object.keys(e).length)&&r.fields[e.__typename]&&r.fields[e.__typename].forEach(a=>{const r=Le(a,`${t}[${n}].${a.id}`,e,i);b[a.type]&&!0!==r&&(o[t]={value:l,subField:a,errorCode:!1!==r?r:void 0})})})):(a||(a=t),o[t]={value:l,field:r,errorCode:!1!==s?s:void 0}),"collection"===r.type&&r.uniqEntries&&l&&f(l,(e,t)=>m(e)===m(t)).length!==l.length&&(o[t]={value:l,field:r}),"collection"===r.type&&r.rules&&"object"==typeof r.rules&&l&&Object.keys(r.rules).forEach(i=>{const n=r.rules[i];Object.keys(n).forEach(a=>{const s=n[a],c=i.indexOf(",")>-1?i.split(","):[i],d=a.indexOf(",")>-1?a.split(","):[a],f=((e=[],t=[])=>{const i=[];return e.forEach(e=>{t.forEach(t=>{i.push([e,t])})}),i})(c,d);let u=!0;if(s.maxCount&&"number"==typeof s.maxCount&&f.forEach(t=>{let i=0;l.forEach(n=>e(n,t[0])===t[1]?i++:void 0),i>s.maxCount&&(u=!1)}),s.minCount&&"number"==typeof s.minCount&&f.forEach(t=>{let i=0;l.forEach(n=>e(n,t[0])===t[1]?i++:void 0),i<s.minCount&&(u=!1)}),s.exactCount&&"number"==typeof s.exactCount&&f.forEach(t=>{let i=0;l.forEach(n=>e(n,t[0])===t[1]?i++:void 0),i!==s.exactCount&&(u=!1)}),s.sameCountAs&&"string"==typeof s.sameCountAs&&f.forEach(t=>{let i=0,n=0;l.forEach(o=>{e(o,t[0])===t[1]&&i++,e(o,t[0])===s.sameCountAs&&n++}),i!==n&&(u=!1)}),s.differentCountAs&&"string"==typeof s.differentCountAs&&f.forEach(t=>{let i=0,n=0;l.forEach(o=>{e(o,t[0])===t[1]&&i++,e(o,t[0])===s.differentCountAs&&n++}),i===n&&(u=!1)}),(s.sameSumAs&&"string"==typeof s.sameSumAs||s.differentSumAs&&"string"==typeof s.differentSumAs||s.biggerSumAs&&"string"==typeof s.biggerSumAs||s.smallerSumAs&&"string"==typeof s.smallerSumAs)&&f.forEach(t=>{let i=0,n=0;l.forEach(o=>{const a=Number(e(o,t[0])),r=Number(e(o,s.sameSumAs||s.differentSumAs||s.biggerSumAs||s.smallerSumAs));isNaN(a)||(i+=a),isNaN(r)||(n+=r)}),s.sameSumAs&&i!==n&&(u=!1),s.differentSumAs&&i===n&&(u=!1),s.biggerSumAs&&i<=n&&(u=!1),s.smallerSumAs&&i>=n&&(u=!1)}),s.isUnique&&c.length>0){const t=[];let i=!1;l.forEach(n=>{const o=c.map(t=>e(n,t));t.forEach(e=>{p(o,e)&&(i=!0)}),t.push(o)}),i&&(u=!1)}s.disallow&&f.forEach(t=>{let i=!1,n=!1;l.forEach(o=>{e(o,t[0])===t[1]&&(n=!0),Array.isArray(s.disallow)?s.disallow.forEach(n=>{e(o,t[0])===n&&(i=!0)}):e(o,t[0])===s.disallow&&(i=!0)}),n&&i&&(u=!1)}),s.disallow&&f.forEach(t=>{let i=!1,n=!1;l.forEach(o=>{e(o,t[0])===t[1]&&(n=!0),Array.isArray(s.disallow)?s.disallow.forEach(n=>{e(o,t[0])===n&&(i=!0)}):e(o,t[0])===s.disallow&&(i=!0)}),n&&!i&&(u=!1)}),u&&"object"==typeof k&&Object.keys(k).forEach(t=>{void 0!==s[t]&&"function"==typeof k[t]&&(k[t]({fieldValueCombos:f,fieldValidationData:l,valueRules:s,get:e})||(u=!1))}),u||(o[t]={value:l,field:r,errorCode:s.errorCode||"invalidRule"})})}),{errors:o,firstErrorField:a}},Pe=(e,t,i="")=>{let n,o={};if(t||(t=W),Re.forEach(e=>{if(""===i||e.path.startsWith(i)){if(!b[e.config.type]&&!Ie(e.config.type))return;const a=qe(e.path,""!==i?"render":"action",t,o,n);o=a.errors,n=a.firstErrorField}}),n&&O&&e){const e=document.getElementById(n);e&&!(e=>{const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)})(e)&&e.scrollIntoView()}return o},We=()=>Pe(!1);n(()=>{if("function"==typeof j&&S){M()&&window.stagesLogging("Get errors on validation",N);let e=Pe(!0);Ee(e),j(e)}},[j]);const Ne=(e,t)=>{M()&&window.stagesLogging(`Get sub form errors for sub id "${e}"`,N),Pe(!0),t&&Object.keys(t).length>0&&(Oe[e]=t)},ze=async(t,i,n)=>{if(i.loader&&"function"==typeof i.loader){const o={};let a,r;const s="number"==typeof ee[t]?ee[t]+1:0;let l=s;ee[t]=s,M()&&window.stagesLogging(`Create dynamic options for field "${t}"`,N),i.enableCaching&&(i.watchFields.forEach(t=>{const i=e(n,t);i&&(o[t]=i)}),a=`${t}-${m(o)}`),i.enableCaching&&me[a]?r=me[a]:(r=await i.loader(n,Ke),l=ee[t]),i.enableCaching&&((e,t)=>{M()&&window.stagesLogging(`Update options cache for "${e}"`,N),he(i=>Object.assign({},i,{[e]:t}))})(a,r),l===s&&(((e,t)=>{M()&&window.stagesLogging(`Update options loaded for "${e}"`,N),ge(i=>Object.assign({},i,{[e]:t}))})(t,r),i.onOptionsChange&&"function"==typeof i.onOptionsChange&&i.onOptionsChange(r,n,Ke))}},_e=(t,i,n,o,a=!1)=>{let r;try{r=m({newData:t,errors:Object.keys(i),id:n,fieldKey:o,interfaceState:q})}catch(e){}(r!==ne||a)&&(v((t=>{const i={},n=Object.assign({},t);return Re.forEach(o=>{if(o.config.isInterfaceState){const a=e(t,o.path);void 0!==a&&(u(i,o.path,a),y(n,o.path))}}),P(i),n})(t),i,n,o,q,Pe(!1,t)),ne=r)},He=()=>{if(Te()&&C&&le>0){const e=le-1,t=JSON.parse(Y[e]);ce(e),Ee(t.errors),_(t.isDirty),G(t.dirtyFields),_e(t.data,t.errors,x)}},Be=()=>{if(Te()&&C&&le<Y.length-1){const e=le+1,t=JSON.parse(Y[e]);ce(e),Ee(t.errors),_(t.isDirty),G(t.dirtyFields),_e(t.data,t.errors,x)}};n(()=>{let t=Object.assign({},W);M()&&window.stagesLogging(`Is visible change to "${O?"visible":"invisible"}"`,N),Re.forEach(i=>{const n=i.config;let o=e(t,i.path);if("collection"===n.type&&n.init){const e=n.min?Number(n.min):1;o&&0!==o.length||(o=[]);for(let i=o.length;i<e;i++)o.push("string"==typeof n.init?"function"==typeof n.setInitialData?n.setInitialData(o,t,n.init):{__typename:n.init}:"function"==typeof n.setInitialData?n.setInitialData(o,t):{});u(t,i.path,o)}}),t=Ue(t),"function"==typeof o.asyncDataLoader&&O&&!pe&&(async()=>{je(!0);const e=await o.asyncDataLoader();ve(e),ue(!0),je(!1)})(),O&&(Array.isArray(Re)&&Re.forEach(e=>{e.config.dynamicOptions&&e.config.dynamicOptions.events&&e.config.dynamicOptions.events.indexOf("init")>-1&&ze(e.path,e.config.dynamicOptions,t)}),0===le&&0===Y.length&&se([m({data:t,isDirty:z,dirtyFields:J,errors:Oe})])),_e(t,Pe(),x)},[O]);const Ue=t=>{const i=Object.assign({},t);return Re.forEach(n=>{if("function"==typeof n.config.computedValue){const o=e(W,n.path.split(".").slice(0,-1).join(".")),a=n.config.computedValue(t,o,q);u(i,n.path,a)}}),i},Me=e=>c(Re,{path:e}).config,Je=(e,t,i)=>{const n=[];return"object"==typeof $&&Object.keys($).forEach(o=>{"function"==typeof $[o]&&$[o]({fieldValue:i,data:t,dirtyFields:J,optionsLoaded:ye,asyncData:be,errors:Oe,focusedField:Se,triggeringEvent:e})&&n.push(o)}),n},Ge=e=>Array.isArray(e)&&1===e.length?e[0]:e,Ke=(t,i,n,o=!1)=>{if(!Te())return;let a,r=!1;const s=+new Date,l=Me(t);o||(oe=s);let c=Object.assign({},n||W),f="function"==typeof l.filter?l.filter(i):i;l.cast&&"function"==typeof l.cast.data&&(f=l.cast.data(f)),l.cast&&"string"==typeof l.cast.data&&(f=Q(f,l.cast.data)),l.cast&&Array.isArray(l.cast.data)&&(f=Q(f,l.cast.data[0],!0)),M()&&window.stagesLogging(`Handle change for field "${t}"`,N),u(c,t,f||void 0),c=Ue(c);const y={data:e(c,t),fieldIsDirty:!!J[t],fieldConfig:l,fieldHasFocus:!(!Se||Se!==t)};o||(0===oe||s-oe<Number(A||400))&&(!l.validateOn&&Array.isArray(w)&&w.indexOf("throttledChange")>-1||l.validateOn&&Array.isArray(l.validateOn)&&l.validateOn.indexOf("throttledChange")>-1||!l.validateOn&&"function"==typeof w&&w(y).indexOf("throttledChange")>-1||l.validateOn&&"function"==typeof l.validateOn&&l.validateOn(y).indexOf("throttledChange")>-1)&&(ie&&clearTimeout(ie),ie=setTimeout(()=>Ke(t,i,n,!0),A||400),r=!0);const g=Je("change",c,f);if(!l.validateOn&&Array.isArray(w)&&g.some(e=>w.indexOf(e)>-1)||l.validateOn&&Array.isArray(l.validateOn)&&g.some(e=>l.validateOn.indexOf(e)>-1)){const e=qe(t,Ge(g),c,Oe);a=Object.assign({},Oe,e.errors),Ee(a)}else if(!l.validateOn&&Array.isArray(w)&&w.indexOf("change")>-1||l.validateOn&&Array.isArray(l.validateOn)&&l.validateOn.indexOf("change")>-1||!l.validateOn&&Array.isArray(w)&&w.indexOf("throttledChange")>-1&&!r||l.validateOn&&Array.isArray(l.validateOn)&&l.validateOn.indexOf("throttledChange")>-1&&!r||!l.validateOn&&"function"==typeof w&&w(y).indexOf("change")>-1||l.validateOn&&"function"==typeof l.validateOn&&l.validateOn(y).indexOf("change")>-1||!l.validateOn&&"function"==typeof w&&w(y).indexOf("throttledChange")>-1&&!r||l.validateOn&&"function"==typeof l.validateOn&&l.validateOn(y).indexOf("throttledChange")>-1&&!r){const e=qe(t,"change",c,Oe);a=Object.assign({},Oe,e.errors),Ee(a)}if(K&&(p(e(c,t),e(K,t))?void 0!==J[t]&&delete J[t]:J[t]={oldData:e(K,t),newData:e(c,t)},_(Object.keys(J).length>0),G(J)),l.clearFields&&(Array.isArray(l.clearFields)||"function"==typeof l.clearFields)){const e=Object.assign({},ye);(Array.isArray(l.clearFields)?l.clearFields:l.clearFields(f,c,a)).forEach(t=>{u(c,t,void 0),delete e[t]}),ge(e)}if(Array.isArray(Re)&&Re.forEach(i=>{i.config.dynamicOptions&&i.config.dynamicOptions.events&&i.config.dynamicOptions.events.indexOf("change")>-1&&i.config.dynamicOptions.watchFields&&i.config.dynamicOptions.watchFields.indexOf(t)>-1&&(!l.dynamicOptions||l.dynamicOptions&&ye[i.path]&&ye[i.path].indexOf(e(c,t))>-1||!ye[i.path])&&ze(i.path,i.config.dynamicOptions,c)}),(e=>{const t=e.split(".").at(-2);return"]"===(t?t.slice(-1):"")})(t)){const i=(e=>{const t=e.split(".");t.pop();let i=t.join(".");if("]"===i.slice(-1)){const e=i.lastIndexOf("[");i=i.substring(0,e)}return i})(t),n=Me(i);if(n.sort&&n.sort.by&&n.sort.by.indexOf(l.id)>-1){let t=e(c,i,[]);t=d(t,n.sort.by),"desc"===n.sort.dir&&(t=t.reverse()),u(c,i,t)}}_e(c,Pe(!1,c),x,t)},Xe=i=>{const n={},o=[];return Re.forEach(a=>{if(!i||a.path.startsWith(`${i}.`))if("fieldset"===a.config.type&&R[a.config.fieldset]){const t=Xe(a.path);u(n,a.path,R[a.config.fieldset].render({params:Z(a.config.params||{},R[a.config.fieldset].params),fieldProps:{fields:e(t,a.path),onCollectionAction:Ye,onWizardNav:Qe,getWizardNavHash:Ze,isWizardStepActive:et,isWizardStepDisabled:tt,modifyConfig:it,data:r,interfaceState:q,errors:Oe,asyncData:be,isDirty:z,focusedField:Se,lastFocusedField:Ae,dirtyFields:J,get:e,getConfig:ot},actionProps:{handleActionClick:nt,handleUndo:He,handleRedo:Be,isDisabled:E,isDirty:z,focusedField:Se,lastFocusedField:Ae,dirtyFields:J,silentlyGetValidationErrors:We}}))}else{const i=((i,n,a)=>{let l=!1;if(o.forEach(e=>{a.startsWith(e)&&(l=!0)}),l)return null;if(!b[i.type]&&"subform"!==i.type&&"group"!==i.type)return null;if("function"==typeof i.isRendered&&!i.isRendered(a,n,W,q))return"group"===i.type&&o.push(a),null;if("group"===i.type)return null;const d=Object.assign({},i);if(d.id=a,ye[a])d.options=ye[a];else if("function"==typeof d.options)d.options=d.options(a,n,W);else if("object"==typeof d.computedOptions){let t=e(r,d.computedOptions.source,[]),n=e(W,a);"function"==typeof d.computedOptions.filter&&(t=t.filter(d.computedOptions.filter)),"function"==typeof d.computedOptions.sort&&(t=t.sort(d.computedOptions.sort)),"function"==typeof d.computedOptions.map&&(t=t.map(d.computedOptions.map)),d.computedOptions.initWith&&Array.isArray(d.computedOptions.initWith)&&(t=d.computedOptions.initWith.concat(t)),i.isUnique&&(t=t.map(t=>{if(""===t.value)return t;const o=a.substring(0,a.lastIndexOf("["));let l=e(r,o,[]);return s(l,{[i.id]:t.value})>-1&&t.value!==n?Object.assign({},t,{disabled:!0}):t})),d.options=t,c(t,{value:n})||(d.value="",u(W,a,""))}return delete d.computedValue,delete d.computedOptions,delete d.filter,delete d.clearFields,delete d.dynamicOptions,delete d.isRendered,delete d.defaultValue,delete d.cleanUp,delete d.precision,d.placeholder&&Array.isArray(d.placeholder)&&d.placeholder.length>1&&(void 0===ae[a]&&(ae[a]=d.placeholder[Math.floor(Math.random()*d.placeholder.length)]),d.placeholder=ae[a]),V[i.type]&&"function"==typeof V[i.type].renderer&&!i.errorRenderer&&(d.errorRenderer=V[i.type].renderer),te&&te[a]&&(d.isValidating=!0),Ie(i.type)||Object.keys(d).forEach(e=>{"id"!==e&&"function"==typeof d[e]&&e.endsWith("Fn")&&(d[e.substring(0,e.length-2)]=d[e]({path:a,fieldData:n,alldata:W,interfaceState:q}),delete d[e])}),"fieldset"===i.type?null:"subform"!==i.type?/*#__PURE__*/t.createElement(b[i.type].component,Object.assign({key:a,value:(f=n,i.cast&&"function"==typeof i.cast.field?i.cast.field(f):i.cast&&"string"==typeof i.cast.field?Q(f,i.cast.field):i.cast&&Array.isArray(i.cast.field)?Q(f,i.cast.field[0],!0):f),initialValue:e(K,a),error:Oe[a],isDirty:!!J[a],isDisabled:E||i.isDisabled,hasFocus:!(!Se||Se!==a),onChange:e=>Ke(a,e),onFocus:()=>(t=>{if(!Te())return;const i=Me(t),n=Object.assign({},W),o=e(n,t);we(t),$e(t);const a={data:o,fieldIsDirty:!!J[t],fieldConfig:i,fieldHasFocus:!(!Se||Se!==t)},r=Je("focus",n,o);if(!i.validateOn&&Array.isArray(w)&&r.some(e=>w.indexOf(e)>-1)||i.validateOn&&Array.isArray(i.validateOn)&&r.some(e=>i.validateOn.indexOf(e)>-1)){const e=qe(t,Ge(r),n,Oe);Ee(Object.assign({},Oe,e.errors)),_e(n,e.errors,x,t)}else if(!i.validateOn&&Array.isArray(w)&&w.indexOf("focus")>-1||i.validateOn&&Array.isArray(i.validateOn)&&i.validateOn.indexOf("focus")>-1||!i.validateOn&&"function"==typeof w&&w(a).indexOf("focus")>-1||i.validateOn&&"function"==typeof i.validateOn&&i.validateOn(a).indexOf("focus")>-1){const e=qe(t,"focus",n,Oe);Ee(Object.assign({},Oe,e.errors)),_e(n,e.errors,x,t)}})(a),onBlur:()=>(t=>{if(!Te())return;we("");const i=Me(t),n=Object.assign({},W),o=Object.assign({},W);let a=e(n,t);oe=0,M()&&window.stagesLogging(`Handle blur for field "${t}"`,N),i.cleanUp&&"function"==typeof i.cleanUp&&void 0!==a&&(a=i.cleanUp(a),u(n,t,a),Ke(t,a,n,!0)),"number"==typeof i.precision&&(u(n,t,Number(a).toFixed(i.precision)),_e(n,Oe,x,t));const r={data:a,fieldIsDirty:!!J[t],fieldConfig:i,fieldHasFocus:!(!Se||Se!==t)},s=Je("blur",n,a);if(!i.validateOn&&Array.isArray(w)&&s.some(e=>w.indexOf(e)>-1)||i.validateOn&&Array.isArray(i.validateOn)&&s.some(e=>i.validateOn.indexOf(e)>-1)){const e=qe(t,Ge(s),n,Oe);Ee(Object.assign({},Oe,e.errors)),_e(n,e.errors,x,t)}else if(!i.validateOn&&Array.isArray(w)&&w.indexOf("blur")>-1||i.validateOn&&Array.isArray(i.validateOn)&&i.validateOn.indexOf("blur")>-1||!i.validateOn&&"function"==typeof w&&w(r).indexOf("blur")>-1||i.validateOn&&"function"==typeof i.validateOn&&i.validateOn(r).indexOf("blur")>-1){const e=qe(t,"blur",n,Oe);Ee(Object.assign({},Oe,e.errors)),_e(n,e.errors,x,t)}if(Array.isArray(Re)&&Re.forEach(e=>{e.config.dynamicOptions&&e.config.dynamicOptions.events&&e.config.dynamicOptions.events.indexOf("blur")>-1&&e.config.dynamicOptions.watchFields&&e.config.dynamicOptions.watchFields.indexOf(i.id)>-1&&ze(e.config.id,e.config.dynamicOptions,n),void 0!==F&&e.config.disableAutoSave&&y(o,e.path)}),(e=>{if(C){const t=[...Y];t.length=le+1,t.push(m({data:e,isDirty:z,dirtyFields:J,errors:Oe})),t.length>D&&t.shift(),se(t),ce(t.length-1)}})(n),void 0!==F)if("local"===F||"session"===F){const e=Pe(!1,n);0===Object.keys(e).length&&B(x,{data:o,isDirty:z,dirtyFields:J},F)}else if("object"!=typeof F||"local"!==F.type&&"session"!==F.type){if("object"==typeof F&&"custom"===F.type&&"function"==typeof F.save){const e=Pe(!1,n);(F.validDataOnly&&0===Object.keys(e).length||!F.validDataOnly)&&F.save(x,{data:o,isDirty:z,dirtyFields:J})}}else{const e=Pe(!1,n);(F.validDataOnly&&0===Object.keys(e).length||!F.validDataOnly)&&B(x,{data:o,isDirty:z,dirtyFields:J},F.type)}})(a)},d)):/*#__PURE__*/t.createElement(re,{config:i.config,render:({fieldProps:e})=>/*#__PURE__*/t.createElement(i.render,e),fields:b,id:a,onChange:(e,t)=>Ke(a,e),onValidation:e=>Ne(a,e),parentRunValidation:de,data:W&&e(W,a),isVisible:O,isDisabled:E,validateOn:w});var f})(a.config,a.data,a.path);i&&u(n,a.path,i)}}),n},Ye=(t,i,n,o)=>{if(!Te())return;const a=Object.assign({},W),r=Me(t),s=r&&r.min?Number(r.min):0,l=r&&r.max?Number(r.max):99999999999999;let c,f=e(a,t,[]),p=!1;if("last"===n&&(n=f.length-1),"last"===o&&(o=f.length-1),M()&&window.stagesLogging(`On collection action "${t}"`,N),"add"===i&&("string"==typeof n&&r.fields[n]?l>f.length&&f.push("function"==typeof r.setInitialData?r.setInitialData(f,a,n):{__typename:n}):l>f.length&&f.push("function"==typeof r.setInitialData?r.setInitialData(f,a):{}),p=!0),"remove"===i&&(s<f.length&&f.splice(n,1),p=!0),"move"===i&&"number"==typeof n&&"number"==typeof o&&n>-1&&o>-1){const[e]=f.splice(n,1);f.splice(o,0,e),p=!0}if("sort"===i&&f.length>0&&n&&(f=d(f,n),p=!0),"duplicate"===i&&"number"==typeof n&&n>-1&&(f.splice(n+1,0,Object.assign({},f[n])),p=!0),r.sort&&r.sort.by&&(f=d(f,r.sort.by),"desc"===r.sort.dir&&(f=f.reverse()),p=!0),"update"===i&&Array.isArray(n)?(p=!0,u(a,t,n)):u(a,t,f),p){const i=e(K,t),n=e(a,t);try{JSON.stringify(i)!==JSON.stringify(n)?(_(!0),J[t]={oldData:i,newData:n},G(J)):(delete J[t],Object.keys(J).forEach(e=>{e.startsWith(t)&&delete J[e]}),G(J),_(Object.keys(J).length>0))}catch(e){}}if(w.indexOf("collectionAction")>-1||r.validateOn&&r.validateOn.indexOf("collectionAction")>-1){const e=qe(t,"collectionAction",a,Oe);c=Object.assign({},Oe,e.errors),Ee(c)}_e(a,c||Pe(),x,t)},Qe=(e,t,i)=>{const n=Object.assign({},ke),o=n[t],a=Me(t);if("step"===e&&(n[t]=i),"next"===e){const e=s(a.stages,{id:o})+1;a.stages[e]&&(n[t]=a.stages[e].id)}if("prev"===e){const e=s(a.stages,{id:o})-1;a.stages[e]&&(n[t]=a.stages[e].id)}"first"===e&&(n[t]=a.stages[0].id),"last"===e&&(n[t]=a.stages[a.stages.length-1].id),Fe(n)},Ze=(e,t,i="step")=>{const n=ke[e],o=Me(e),a=[];if("step"===i||"first"===i||"last"===i)return Object.keys(ke).forEach(n=>{n.startsWith(e)?("step"===i&&a.push(`${n}.${t}`),"first"===i&&a.push(`${n}.${o.stages[0].id}`),"last"===i&&a.push(`${n}.${o.stages[o.stages.length-1].id}`)):a.push(`${n}.${ke[n]}`)}),`#!${a.join(I||":")}`;if("prev"===i){const t=s(o.stages,{id:n})-1;return!!o.stages[t]&&(Object.keys(ke).forEach(i=>{i.startsWith(e)?a.push(`${i}.${o.stages[t].id}`):a.push(`${i}.${ke[i]}`)}),`#!${a.join(I||":")}`)}if("next"===i){const t=s(o.stages,{id:n})+1;return!!o.stages[t]&&(Object.keys(ke).forEach(i=>{i.startsWith(e)?a.push(`${i}.${o.stages[t].id}`):a.push(`${i}.${ke[i]}`)}),`#!${a.join(I||":")}`)}return!1},et=(e,t)=>ke[e]===t,tt=(e,t,i=!1)=>{const n=t.substring(2).split(I||":");let o="";if(n.forEach(t=>{t.startsWith(`${e}.`)&&(o=t.substring(e.length+1))}),o){const t=Me(e),n=s(t.stages,{id:o});if(n>s(t.stages,{id:ke[e]})+1)return!0;if(i&&et(e,o))return!0;for(let i=0;i<n;i++){const n=Pe(!1,r,`${e}.${t.stages[i].id}`);if(Object.keys(n).length>0)return!0}}return!1},it=(t,i,n)=>{if(o.fieldConfigs&&"function"==typeof o.fieldConfigs[i]){const a=t.split(".");let r="";a.forEach(t=>{const i=r?e(Ve,r):Ve;if(t.endsWith("]")){const e=t.split("["),n=s(i,{id:e[0]});n>-1&&(r+=`[${n}].fields`)}else{const e=s(i,{id:t});e>-1&&(r+=`[${e}].fields`)}}),""!==r&&(Ce.push({fields:o.fieldConfigs[i],path:r,action:n}),De([...Ce]))}},nt=(e,t,i)=>{M()&&window.stagesLogging("Handle action click",N),i&&("local"!==F&&"session"!==F||U(x,F),"object"!=typeof F||"local"!==F.type&&"session"!==F.type||U(x,F.type),x&&"object"==typeof F&&"custom"===F.type&&"function"==typeof F.remove&&F.remove(x),_e(K,Pe(),x),G({}),_(!1));const n=Je("action",W);let o=!1;if(Array.isArray(w)&&w.indexOf("action")>-1||Array.isArray(w)&&n.some(e=>w.indexOf(e)>-1)){t&&(fe(!0),setTimeout(()=>fe(!1),0));let e=t?Pe(!0):{};Ee(e),Object.keys(e).length>0&&(o=!0)}o||e()},ot=e=>{const t=c(Re,{path:e});return t?t.config:void 0};return!1===O?null:l?l({actionProps:{handleActionClick:nt,handleUndo:He,handleRedo:Be,isDisabled:!!(te&&Object.keys(te).length>0)||E,isDirty:z,focusedField:Se,lastFocusedField:Ae,dirtyFields:J,silentlyGetValidationErrors:We,updateData:t=>{_e(t,Pe(),x);let i=!1,n={};Re.forEach(o=>{if(!o.config.isInterfaceState){const a=e(t,o.path),r=e(K,o.path);a!==r&&(i=!0,void 0!==a&&(n[o.path]={oldData:r,newData:a}))}}),_(i),G(n)}},fieldProps:{fields:Xe(),onCollectionAction:Ye,onWizardNav:Qe,getWizardNavHash:Ze,isWizardStepActive:et,isWizardStepDisabled:tt,modifyConfig:it,data:r,interfaceState:q,errors:Oe,asyncData:be,isDirty:z,focusedField:Se,lastFocusedField:Ae,dirtyFields:J,get:e,getConfig:ot},loading:xe}):h?h(Xe()):null};re.propTypes={config:_.oneOfType([_.object,_.array,_.func]).isRequired,data:_.object,render:_.oneOfType([_.node,_.func]),renderFields:_.oneOfType([_.node,_.func]),fields:_.object.isRequired,onChange:_.func,isVisible:_.bool,isDisabled:_.bool,id:_.oneOfType([_.string,_.number]),onValidation:_.func,parentRunValidation:_.bool,validateOn:_.array,customRuleHandlers:_.object,undoMaxDepth:_.number,typeValidations:_.object,fieldsets:_.object,initialInterfaceState:_.object},re.defaultProps={data:{},onChange:()=>{},isVisible:!0,isDisabled:!1,validateOn:["action"],customRuleHandlers:{},undoMaxDepth:10,autoSave:!1,typeValidations:{},fieldsets:{},initialInterfaceState:{}};const se=({config:e,handleActionClick:i,isDisabled:n})=>/*#__PURE__*/t.createElement(t.Fragment,null,e.map((e,o)=>/*#__PURE__*/t.createElement("button",{type:"button",onClick:()=>i(e.onClick,e.validate),key:`action-${o}`,disabled:n},"primary"===e.type?/*#__PURE__*/t.createElement("strong",null,e.title):e.title)));function le(e,t){if(null==e)return{};var i,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(i=a[n])>=0||(o[i]=e[i]);return o}const ce=["id","label","value","onChange","onBlur","onFocus","error","placeholder","isRequired","isDisabled","isValidating","hasFocus","prefix","suffix","secondaryText","type","errorRenderer"],de=e=>{let{id:i,label:n,value:o,onChange:a,onBlur:r,onFocus:s,error:l,placeholder:c,isRequired:d,isDisabled:f,isValidating:p,prefix:u,suffix:y,secondaryText:g,type:m,errorRenderer:h}=e;return le(e,ce),console.log({id:i,value:o}),/*#__PURE__*/t.createElement("div",null,n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,d?" *":""):null,/*#__PURE__*/t.createElement("div",null,u?/*#__PURE__*/t.createElement("span",null,u):null,/*#__PURE__*/t.createElement("input",{id:i,name:i,value:void 0!==o?o:"number"===m?0:"",placeholder:c,type:m||"text",disabled:!!f,required:!!d,autoComplete:"password"===m?"current-password":"off",onChange:e=>{"function"==typeof a&&a(e.target.value)},onFocus:e=>{"function"==typeof s&&s()},onBlur:e=>{"function"==typeof r&&r()}}),y?/*#__PURE__*/t.createElement("span",null,y):null),g?/*#__PURE__*/t.createElement("div",null,g):null,l&&!p?h?h(l):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,p?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},fe=(e,t)=>!t.isRequired||""!==e&&void 0!==e,pe=["id","label","value","onChange","onBlur","onFocus","error","placeholder","isRequired","isDisabled","isValidating","prefix","suffix","secondaryText","type","errorRenderer"],ue=["id","label","value","options","onChange","onBlur","onFocus","error","placeholder","isRequired","isDisabled","isValidating","prefix","suffix","secondaryText","errorRenderer"],ye=["id","label","value","options","onChange","onBlur","onFocus","error","isRequired","isDisabled","isValidating","prefix","suffix","secondaryText","errorRenderer"],ge=["id","label","error","isRequired","isValidating","secondaryText","errorRenderer"],me={text:{component:de,isValid:fe},number:{component:de,isValid:fe},email:{component:de,isValid:fe},password:{component:de,isValid:fe},tel:{component:de,isValid:fe},time:{component:de,isValid:fe},date:{component:de,isValid:fe},checkbox:{component:e=>{let{id:i,label:n,value:o,onChange:a,onBlur:r,onFocus:s,error:l,placeholder:c,isRequired:d,isDisabled:f,isValidating:p,prefix:u,suffix:y,secondaryText:g,type:m,errorRenderer:h}=e;return le(e,pe),/*#__PURE__*/t.createElement("div",null,n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,d?" *":""):null,/*#__PURE__*/t.createElement("div",null,u?/*#__PURE__*/t.createElement("span",null,u):null,/*#__PURE__*/t.createElement("input",{id:i,name:i,value:"1",placeholder:c,type:m,disabled:!!f,required:!!d,checked:!!o,onChange:()=>{},onClick:e=>{"function"==typeof a&&a(!!e.target.checked)},onBlur:e=>{"function"==typeof r&&r()},onFocus:e=>{"function"==typeof s&&s()}}),y?/*#__PURE__*/t.createElement("span",null,y):null),g?/*#__PURE__*/t.createElement("div",null,g):null,l&&!p?h?h(l):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,p?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},isValid:(e,t)=>!t.isRequired||""!==e&&void 0!==e},select:{component:e=>{let{id:i,label:n,value:o,options:a,onChange:r,onBlur:s,onFocus:l,error:c,placeholder:d,isRequired:f,isDisabled:p,isValidating:u,prefix:y,suffix:g,secondaryText:m,errorRenderer:h}=e;return le(e,ue),/*#__PURE__*/t.createElement("div",null,n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,f?" *":""):null,/*#__PURE__*/t.createElement("div",null,y?/*#__PURE__*/t.createElement("span",null,y):null,/*#__PURE__*/t.createElement("select",{id:i,name:i,value:void 0===o?"":o,placeholder:d,disabled:!!p,required:!!f,onChange:e=>{"function"==typeof r&&r(e.target.value)},onBlur:e=>{"function"==typeof s&&s()},onFocus:e=>{"function"==typeof l&&l()}},a.map(e=>/*#__PURE__*/t.createElement("option",{value:e.value,key:e.value,disabled:!!e.disabled||null},e.text))),g?/*#__PURE__*/t.createElement("span",null,g):null),m?/*#__PURE__*/t.createElement("div",null,m):null,c&&!u?h?h(c):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,u?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},isValid:(e,t)=>!t.isRequired||""!==e&&void 0!==e},radio:{component:e=>{let{id:i,label:n,value:o,options:a,onChange:s,onBlur:l,onFocus:c,error:d,isRequired:f,isDisabled:p,isValidating:u,prefix:y,suffix:g,secondaryText:m,errorRenderer:h}=e;return le(e,ye),/*#__PURE__*/t.createElement("div",{id:i},n?/*#__PURE__*/t.createElement("label",null,n,f?" *":""):null,/*#__PURE__*/t.createElement("div",null,y?/*#__PURE__*/t.createElement("span",null,y):null,a.map(e=>/*#__PURE__*/t.createElement(r,{key:`${i}-${e.value}`},/*#__PURE__*/t.createElement("input",{type:"radio",name:i,id:`${i}-${e.value}`,value:e.value,checked:o===e.value,disabled:!!p,onChange:()=>{},onClick:t=>{"function"==typeof s&&s(e.value)},onBlur:e=>{"function"==typeof l&&l()},onFocus:e=>{"function"==typeof c&&c()}}),/*#__PURE__*/t.createElement("label",{htmlFor:`${i}-${e.value}`},e.text)," ")),g?/*#__PURE__*/t.createElement("span",null,g):null),m?/*#__PURE__*/t.createElement("div",null,m):null,d&&!u?h?h(d):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,u?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null)},isValid:(e,t)=>!t.isRequired||""!==e&&void 0!==e},dummy:{component:e=>{let{id:i,label:n,error:o,isRequired:a,isValidating:r,secondaryText:s,errorRenderer:l}=e;return le(e,ge),n||s||o?/*#__PURE__*/t.createElement("div",{id:i},n?/*#__PURE__*/t.createElement("label",{htmlFor:i},n,a?" *":""):null,s?/*#__PURE__*/t.createElement("div",null,s):null,o&&!r?l?l(o):/*#__PURE__*/t.createElement("div",{style:{color:"red"}},"Please fill out this field!"):null,r?/*#__PURE__*/t.createElement("div",{style:{color:"#999"}},"Field is validating ..."):null):null},isValid:()=>!0}};export{se as Actions,Y as Debugger,re as Form,G as HashRouter,K as Navigation,X as Progression,J as Stages,me as plainFields};
//# sourceMappingURL=lib.modern.mjs.map
